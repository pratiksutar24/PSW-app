<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSW Assessment Suite - Dr. [Your Name]</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Secure psychiatric social work assessment suite for mental health professionals">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PSW Suite">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%232563eb'/><text y='70' font-size='60' text-anchor='middle' x='50' fill='white'>🧠</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%232563eb'/><text y='70' font-size='60' text-anchor='middle' x='50' fill='white'>🧠</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{
        'name': 'PSW Assessment Suite',
        'short_name': 'PSW Suite',
        'description': 'Secure psychiatric social work assessment suite',
        'start_url': '/',
        'display': 'standalone',
        'background_color': '#ffffff',
        'theme_color': '#2563eb',
        'orientation': 'portrait-primary',
        'icons': [
            {
                'src': 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect width=\"100\" height=\"100\" fill=\"%232563eb\"/><text y=\"70\" font-size=\"60\" text-anchor=\"middle\" x=\"50\" fill=\"white\">🧠</text></svg>',
                'sizes': '192x192',
                'type': 'image/svg+xml'
            },
            {
                'src': 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect width=\"100\" height=\"100\" fill=\"%232563eb\"/><text y=\"70\" font-size=\"60\" text-anchor=\"middle\" x=\"50\" fill=\"white\">🧠</text></svg>',
                'sizes': '512x512',
                'type': 'image/svg+xml'
            }
        ]
    }">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .assessment-progress {
            transition: width 0.3s ease;
        }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
        
        /* Mobile Optimizations */
        .mobile-optimized {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .mobile-optimized input, 
        .mobile-optimized textarea, 
        .mobile-optimized select {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        @media (max-width: 768px) {
            .assessment-card {
                padding: 1rem;
            }
            
            .question-container {
                padding: 1rem;
            }
            
            .mobile-stack {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .mobile-full-width {
                width: 100%;
            }
        }
        
        /* PWA Styles */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* Login Screen Animations */
        .login-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">PSW</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">PSW Assessment Suite</h1>
                            <p class="text-xs text-gray-600">Pratik Sutar - Licensed Psychiatric Social Worker</p>
                        </div>
                    </div>
                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">LCSW-12345</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <span id="current-date"></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div id="connection-status" class="flex items-center text-xs">
                            <div id="connection-dot" class="w-2 h-2 rounded-full bg-gray-400 mr-1"></div>
                            <span id="connection-text">Checking...</span>
                        </div>
                        <span id="pending-sync-badge" class="hidden bg-orange-500 text-white text-xs px-2 py-1 rounded-full">
                            <span id="pending-sync-count">0</span> pending
                        </span>
                    </div>
                    <button onclick="showSettings()" class="p-2 text-gray-400 hover:text-gray-600" title="Settings">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                    <button onclick="authSystem.logout()" class="p-2 text-gray-400 hover:text-red-600" title="Logout">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl max-w-md w-full p-6 card-shadow">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-900">Settings</h2>
                <button onclick="closeModal('settings-modal')" class="text-gray-400 hover:text-gray-600">×</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                    <input type="text" id="practitioner-name" value="Pratik Sutar" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">License Number</label>
                    <input type="text" id="license-number" value="LCSW-12345" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email for Reports</label>
                    <input type="email" id="practitioner-email" value="pratik.sutar@example.com" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Practice/Institution</label>
                    <input type="text" id="practice-name" value="Private Practice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Security Settings -->
                <div class="border-t pt-4 mt-4">
                    <h3 class="text-lg font-semibold mb-3">🔐 Security Settings</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Change Passcode</label>
                            <input type="password" id="new-passcode" placeholder="Enter new passcode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-gray-500 mt-1">Leave blank to keep current passcode</p>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <p class="text-xs text-yellow-800">
                                🔒 <strong>Security Features Active:</strong><br>
                                • 30-minute auto-logout<br>
                                • 3 failed attempts = 15-minute lockout<br>
                                • Local data encryption<br>
                                • Offline-first privacy
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Network Status Display -->
                <div class="border-t pt-4 mt-4">
                    <h3 class="text-lg font-semibold mb-3">📡 Network Status</h3>
                    <div id="network-status-display">
                        <!-- Network status will be populated here -->
                    </div>
                </div>
                
                <!-- Auto-Sync Settings -->
                <div class="border-t pt-4 mt-4">
                    <h3 class="text-lg font-semibold mb-3">📧 Auto-Sync Settings</h3>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="auto-sync-enabled" class="mr-2 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm">Auto-email reports when internet is available</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="sync-on-wifi" class="mr-2 text-blue-600 focus:ring-blue-500" checked>
                            <span class="text-sm">📶 Sync when WiFi is connected (recommended)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="sync-on-mobile" class="mr-2 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm">📱 Sync on mobile data (may use cellular data)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="sync-on-slow-connection" class="mr-2 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm">🐌 Allow sync on slow connections (2G/3G)</span>
                        </label>
                        
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-xs text-blue-800">
                                📱 <strong>Pending emails:</strong> <span id="pending-count">0</span> reports waiting to sync
                            </p>
                            <div class="mt-2 flex space-x-2">
                                <button onclick="forceSyncNow()" class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">
                                    Sync Now
                                </button>
                                <button onclick="testNetworkSpeed()" class="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700">
                                    Test Speed
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <h4 class="font-semibold text-yellow-800 mb-2">📊 Data Usage Tips:</h4>
                            <ul class="text-xs text-yellow-700 space-y-1">
                                <li>• WiFi sync uses no cellular data</li>
                                <li>• Mobile data sync uses ~50-200KB per report</li>
                                <li>• Sync is paused when Data Saver is enabled</li>
                                <li>• Large assessments may use more data</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-medium">
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="hidden fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 card-shadow">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-xl">🔒</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">PSW Assessment Suite</h1>
                <p class="text-gray-600">Secure Access Required</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Enter Passcode</label>
                    <input type="password" id="passcode-input" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-lg tracking-widest"
                           placeholder="••••••••" maxlength="20" autocomplete="off">
                </div>
                
                <button type="submit" id="login-btn" 
                        class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium transition-colors">
                    🔓 Unlock App
                </button>
                
                <div id="login-error" class="hidden text-red-600 text-sm text-center"></div>
                <div id="lockout-message" class="hidden text-orange-600 text-sm text-center"></div>
            </form>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="text-center">
                    <p class="text-xs text-gray-500 mb-4">Your secure passcode: <code class="bg-gray-100 px-2 py-1 rounded">chikupratik</code></p>
                    <button onclick="showPasscodeHelp()" class="text-blue-600 hover:text-blue-800 text-sm">
                        Need help? 🤔
                    </button>
                </div>
            </div>
            
            <!-- Mobile Install Button -->
            <div id="install-app-btn" class="hidden mt-6 text-center">
                <button onclick="mobileApp.installApp()" 
                        class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 text-sm">
                    📱 Install as Mobile App
                </button>
            </div>
        </div>
    </div>

    <!-- Passcode Help Modal -->
    <div id="passcode-help-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-lg w-full p-6 card-shadow">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-900">🔐 Passcode Help</h2>
                <button onclick="closeModal('passcode-help-modal')" class="text-gray-400 hover:text-gray-600">×</button>
            </div>
            
            <div class="space-y-4 text-sm">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-900 mb-2">🆕 First Time Setup</h3>
                    <p class="text-blue-800">Your secure passcode: <code class="bg-blue-100 px-2 py-1 rounded font-mono">chikupratik</code></p>
                    <p class="text-blue-700 mt-2">Change this in Settings after logging in!</p>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-yellow-900 mb-2">🔒 Security Features</h3>
                    <ul class="text-yellow-800 space-y-1">
                        <li>• 30-minute auto-logout for security</li>
                        <li>• 3 failed attempts = 15-minute lockout</li>
                        <li>• All data is encrypted locally</li>
                        <li>• Works offline for privacy</li>
                    </ul>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-green-900 mb-2">📱 Mobile Usage</h3>
                    <ul class="text-green-800 space-y-1">
                        <li>• Install as app for better experience</li>
                        <li>• Works offline once installed</li>
                        <li>• Auto-sync when internet available</li>
                        <li>• Secure local storage only</li>
                    </ul>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-red-900 mb-2">🚨 Forgot Passcode?</h3>
                    <p class="text-red-800">Contact your system administrator or clear browser data (will lose all assessments).</p>
                </div>
            </div>
            
            <button onclick="closeModal('passcode-help-modal')" 
                    class="w-full mt-6 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">
                Got it! 👍
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dashboard -->
        <div id="dashboard">
            <!-- Welcome Section -->
            <div class="gradient-bg rounded-2xl p-8 mb-8 text-white">
                <h1 class="text-3xl font-bold mb-2">Welcome to Your Assessment Suite</h1>
                <p class="text-lg opacity-90 mb-4">Comprehensive psychiatric and psychosocial assessments for your practice</p>
                <div class="flex flex-wrap gap-3">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">🧠 Mental Health Assessments</span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">📊 Automated Reports</span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">📧 Email Integration</span>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Assessments Today</p>
                            <p class="text-2xl font-bold text-blue-600"><span id="today-count">0</span></p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <span class="text-blue-600 text-xl">📋</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">This Week</p>
                            <p class="text-2xl font-bold text-green-600"><span id="week-count">0</span></p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <span class="text-green-600 text-xl">📈</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Total Clients</p>
                            <p class="text-2xl font-bold text-purple-600"><span id="total-clients">0</span></p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <span class="text-purple-600 text-xl">👥</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Reports Generated</p>
                            <p class="text-2xl font-bold text-orange-600"><span id="reports-count">0</span></p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <span class="text-orange-600 text-xl">📄</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assessment Types -->
            <div class="bg-white rounded-xl p-8 card-shadow mb-8">
                <h2 class="text-2xl font-bold mb-6">Start New Assessment</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Mental Status Exam -->
                    <div class="border-2 border-blue-200 rounded-xl p-6 hover:border-blue-400 cursor-pointer transition-colors" onclick="startAssessment('mental-status')">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-blue-600 text-xl">🧠</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Mental Status Exam</h3>
                        <p class="text-sm text-gray-600 mb-3">Comprehensive psychiatric evaluation including mood, cognition, and behavior assessment</p>
                        <div class="text-xs text-blue-600 font-medium">~15-20 minutes</div>
                    </div>

                    <!-- Psychosocial Assessment -->
                    <div class="border-2 border-green-200 rounded-xl p-6 hover:border-green-400 cursor-pointer transition-colors" onclick="startAssessment('psychosocial')">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-green-600 text-xl">🤝</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Psychosocial Assessment</h3>
                        <p class="text-sm text-gray-600 mb-3">Detailed social history, support systems, and environmental factors evaluation</p>
                        <div class="text-xs text-green-600 font-medium">~25-30 minutes</div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="border-2 border-red-200 rounded-xl p-6 hover:border-red-400 cursor-pointer transition-colors" onclick="startAssessment('risk-assessment')">
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-red-600 text-xl">⚠️</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Risk Assessment</h3>
                        <p class="text-sm text-gray-600 mb-3">Suicide, self-harm, and violence risk evaluation with safety planning</p>
                        <div class="text-xs text-red-600 font-medium">~10-15 minutes</div>
                    </div>

                    <!-- Substance Use Assessment -->
                    <div class="border-2 border-purple-200 rounded-xl p-6 hover:border-purple-400 cursor-pointer transition-colors" onclick="startAssessment('substance-use')">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-purple-600 text-xl">🍷</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Substance Use Assessment</h3>
                        <p class="text-sm text-gray-600 mb-3">Comprehensive substance use history and dependency evaluation</p>
                        <div class="text-xs text-purple-600 font-medium">~20-25 minutes</div>
                    </div>

                    <!-- Depression Screening -->
                    <div class="border-2 border-indigo-200 rounded-xl p-6 hover:border-indigo-400 cursor-pointer transition-colors" onclick="startAssessment('depression')">
                        <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-indigo-600 text-xl">😔</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Depression Screening</h3>
                        <p class="text-sm text-gray-600 mb-3">PHQ-9 and comprehensive depression assessment with severity rating</p>
                        <div class="text-xs text-indigo-600 font-medium">~10-12 minutes</div>
                    </div>

                    <!-- Anxiety Assessment -->
                    <div class="border-2 border-yellow-200 rounded-xl p-6 hover:border-yellow-400 cursor-pointer transition-colors" onclick="startAssessment('anxiety')">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-yellow-600 text-xl">😰</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Anxiety Assessment</h3>
                        <p class="text-sm text-gray-600 mb-3">GAD-7 and comprehensive anxiety disorders evaluation</p>
                        <div class="text-xs text-yellow-600 font-medium">~8-10 minutes</div>
                    </div>

                    <!-- Career Assessment -->
                    <div class="border-2 border-teal-200 rounded-xl p-6 hover:border-teal-400 cursor-pointer transition-colors" onclick="startAssessment('career')">
                        <div class="w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center mb-4">
                            <span class="text-teal-600 text-xl">💼</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">Career Assessment</h3>
                        <p class="text-sm text-gray-600 mb-3">Comprehensive 120-question career interests, skills, and work values evaluation</p>
                        <div class="text-xs text-teal-600 font-medium">~45-60 minutes</div>
                    </div>
                </div>
            </div>

            <!-- Recent Assessments -->
            <div class="bg-white rounded-xl p-8 card-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Recent Assessments</h2>
                    <button onclick="viewAllReports()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">View All Reports</button>
                </div>
                <div id="recent-assessments-list">
                    <p class="text-gray-600 text-center py-8">No assessments completed yet. Start your first assessment above!</p>
                </div>
            </div>
        </div>

        <!-- Assessment Interface -->
        <div id="assessment-interface" class="hidden">
            <!-- Assessment Header -->
            <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 class="text-2xl font-bold" id="assessment-title">Assessment</h1>
                        <p class="text-gray-600" id="assessment-description">Assessment description</p>
                    </div>
                    <button onclick="exitAssessment()" class="text-gray-400 hover:text-gray-600 no-print">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full assessment-progress" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm text-gray-600">
                    <span>Question <span id="current-question">1</span> of <span id="total-questions">10</span></span>
                    <span id="progress-percentage">0%</span>
                </div>
            </div>

            <!-- Client Information -->
            <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                <h2 class="text-lg font-bold mb-4">Client Information</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                        <input type="text" id="client-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                        <input type="date" id="client-dob" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Client ID (Optional)</label>
                        <input type="text" id="client-id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Session Date</label>
                        <input type="date" id="session-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Assessment Questions -->
            <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                <div id="question-container">
                    <!-- Questions will be dynamically loaded here -->
                </div>
                
                <div class="flex justify-between mt-6 no-print">
                    <button id="prev-btn" onclick="previousQuestion()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 disabled:opacity-50" disabled>
                        Previous
                    </button>
                    <button id="next-btn" onclick="nextQuestion()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Next
                    </button>
                    <button id="complete-btn" onclick="completeAssessment()" class="hidden px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        Complete Assessment
                    </button>
                </div>
            </div>
        </div>

        <!-- Report View -->
        <div id="report-view" class="hidden">
            <div class="bg-white rounded-xl p-8 card-shadow">
                <!-- Report Header -->
                <div class="border-b pb-6 mb-6">
                    <div class="flex justify-between items-start no-print">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 mb-2">Assessment Report</h1>
                            <p class="text-gray-600">Generated on <span id="report-date"></span></p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="printReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Print Report
                            </button>
                            <button onclick="printAssessmentQuestions()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                Print Questions
                            </button>
                            <button onclick="emailReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Email Report
                            </button>
                            <button onclick="backToDashboard()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                                Back to Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <!-- Print Header -->
                    <div class="print-only">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h1 class="text-2xl font-bold">PSW Assessment Report</h1>
                                <p class="text-sm text-gray-600" id="print-practitioner-info">Pratik Sutar - LCSW-12345</p>
                            </div>
                            <div class="text-right text-sm">
                                <p>Date: <span id="print-date"></span></p>
                                <p>Page 1 of 1</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Content -->
                <div id="report-content">
                    <!-- Report content will be generated here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentAssessment = null;
        let currentQuestionIndex = 0;
        let assessmentData = {};
        let assessmentResponses = {};
        let completedAssessments = JSON.parse(localStorage.getItem('completedAssessments') || '[]');
        let pendingEmailQueue = JSON.parse(localStorage.getItem('pendingEmailQueue') || '[]');
        let autoSyncEnabled = JSON.parse(localStorage.getItem('autoSyncEnabled') || 'true');
        
        // Security Configuration
        const SECURITY_CONFIG = {
            requireAuth: true,
            sessionTimeout: 30 * 60 * 1000, // 30 minutes
            maxFailedAttempts: 3,
            lockoutDuration: 15 * 60 * 1000, // 15 minutes
            encryptData: true
        };
        
        // Mobile Detection and Configuration
        const MOBILE_CONFIG = {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isStandalone: window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches,
            enableOfflineMode: true,
            enablePushNotifications: true,
            enableNetworkSync: true,
            preferWiFi: true,
            allowMobileData: true
        };
        
        // Network Configuration
        const NETWORK_CONFIG = {
            syncEndpoint: 'https://api.pswsuite.com/sync', // Your backend endpoint
            maxRetries: 3,
            retryDelay: 2000,
            timeoutDuration: 30000,
            compressionEnabled: true,
            encryptionEnabled: true
        };
        
        // Secure Storage with Encryption
        class SecureStorage {
            constructor() {
                this.key = this.generateKey();
            }
            
            generateKey() {
                let key = localStorage.getItem('pswSecureKey');
                if (!key) {
                    key = this.createSecureKey();
                    localStorage.setItem('pswSecureKey', key);
                }
                return key;
            }
            
            createSecureKey() {
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
            }
            
            encrypt(data) {
                if (!SECURITY_CONFIG.encryptData) return data;
                try {
                    return btoa(JSON.stringify(data));
                } catch (e) {
                    console.error('Encryption failed:', e);
                    return data;
                }
            }
            
            decrypt(data) {
                if (!SECURITY_CONFIG.encryptData) return data;
                try {
                    return JSON.parse(atob(data));
                } catch (e) {
                    console.error('Decryption failed:', e);
                    return data;
                }
            }
            
            setItem(key, value) {
                const encrypted = this.encrypt(value);
                localStorage.setItem(`psw_${key}`, encrypted);
            }
            
            getItem(key) {
                const encrypted = localStorage.getItem(`psw_${key}`);
                return encrypted ? this.decrypt(encrypted) : null;
            }
        }
        
        const secureStorage = new SecureStorage();

        // Assessment templates
        const assessmentTemplates = {
            'mental-status': {
                title: 'Mental Status Examination',
                description: 'Comprehensive psychiatric evaluation',
                questions: [
                    {
                        id: 'appearance',
                        type: 'textarea',
                        question: 'Appearance and Behavior',
                        placeholder: 'Describe client\'s general appearance, grooming, posture, eye contact, and overall behavior...'
                    },
                    {
                        id: 'speech',
                        type: 'textarea',
                        question: 'Speech and Language',
                        placeholder: 'Rate, volume, tone, fluency, articulation, and content of speech...'
                    },
                    {
                        id: 'mood',
                        type: 'select',
                        question: 'Mood (Subjective)',
                        options: ['Euthymic', 'Depressed', 'Anxious', 'Irritable', 'Elevated', 'Labile', 'Other']
                    },
                    {
                        id: 'affect',
                        type: 'select',
                        question: 'Affect (Objective)',
                        options: ['Appropriate', 'Flat', 'Blunted', 'Labile', 'Inappropriate', 'Constricted']
                    },
                    {
                        id: 'thought_process',
                        type: 'checkbox',
                        question: 'Thought Process',
                        options: ['Linear', 'Goal-directed', 'Circumstantial', 'Tangential', 'Flight of ideas', 'Loose associations', 'Thought blocking']
                    },
                    {
                        id: 'thought_content',
                        type: 'textarea',
                        question: 'Thought Content',
                        placeholder: 'Delusions, obsessions, compulsions, phobias, suicidal/homicidal ideation...'
                    },
                    {
                        id: 'perceptual',
                        type: 'textarea',
                        question: 'Perceptual Disturbances',
                        placeholder: 'Hallucinations (auditory, visual, tactile, olfactory, gustatory), illusions...'
                    },
                    {
                        id: 'cognition',
                        type: 'select',
                        question: 'Cognitive Function',
                        options: ['Intact', 'Mildly impaired', 'Moderately impaired', 'Severely impaired']
                    },
                    {
                        id: 'insight',
                        type: 'select',
                        question: 'Insight',
                        options: ['Good', 'Fair', 'Poor', 'Absent']
                    },
                    {
                        id: 'judgment',
                        type: 'select',
                        question: 'Judgment',
                        options: ['Good', 'Fair', 'Poor', 'Impaired']
                    }
                ]
            },
            'psychosocial': {
                title: 'Psychosocial Assessment',
                description: 'Comprehensive social and environmental evaluation',
                questions: [
                    {
                        id: 'presenting_problem',
                        type: 'textarea',
                        question: 'Presenting Problem',
                        placeholder: 'Chief complaint and current concerns in client\'s own words...'
                    },
                    {
                        id: 'family_history',
                        type: 'textarea',
                        question: 'Family History',
                        placeholder: 'Family composition, relationships, mental health history, substance use...'
                    },
                    {
                        id: 'social_support',
                        type: 'textarea',
                        question: 'Social Support System',
                        placeholder: 'Friends, family, community connections, support quality and availability...'
                    },
                    {
                        id: 'employment',
                        type: 'textarea',
                        question: 'Employment/Education',
                        placeholder: 'Current work/school status, history, satisfaction, challenges...'
                    },
                    {
                        id: 'housing',
                        type: 'select',
                        question: 'Housing Situation',
                        options: ['Stable housing', 'Temporary housing', 'Homeless', 'Assisted living', 'Institutional care']
                    },
                    {
                        id: 'financial',
                        type: 'select',
                        question: 'Financial Status',
                        options: ['Stable', 'Some concerns', 'Significant stress', 'Crisis']
                    },
                    {
                        id: 'legal',
                        type: 'textarea',
                        question: 'Legal Issues',
                        placeholder: 'Current or past legal problems, court involvement, probation...'
                    },
                    {
                        id: 'cultural',
                        type: 'textarea',
                        question: 'Cultural/Spiritual Factors',
                        placeholder: 'Cultural background, religious/spiritual beliefs, cultural stressors...'
                    },
                    {
                        id: 'strengths',
                        type: 'textarea',
                        question: 'Client Strengths',
                        placeholder: 'Personal strengths, coping skills, resources, resilience factors...'
                    },
                    {
                        id: 'barriers',
                        type: 'textarea',
                        question: 'Barriers to Treatment',
                        placeholder: 'Transportation, financial, cultural, motivational, or other barriers...'
                    }
                ]
            },
            'risk-assessment': {
                title: 'Risk Assessment',
                description: 'Suicide, self-harm, and violence risk evaluation',
                questions: [
                    {
                        id: 'suicidal_ideation',
                        type: 'radio',
                        question: 'Current Suicidal Ideation',
                        options: ['None', 'Passive (wishes to die)', 'Active without plan', 'Active with plan', 'Active with plan and means']
                    },
                    {
                        id: 'suicide_history',
                        type: 'textarea',
                        question: 'Suicide Attempt History',
                        placeholder: 'Previous attempts, methods, circumstances, outcomes...'
                    },
                    {
                        id: 'self_harm',
                        type: 'radio',
                        question: 'Self-Harm Behaviors',
                        options: ['None reported', 'Past history only', 'Recent (within 6 months)', 'Current/ongoing']
                    },
                    {
                        id: 'homicidal_ideation',
                        type: 'radio',
                        question: 'Homicidal/Violence Risk',
                        options: ['None', 'General thoughts', 'Specific target identified', 'Plan developed', 'Imminent risk']
                    },
                    {
                        id: 'risk_factors',
                        type: 'checkbox',
                        question: 'Risk Factors Present',
                        options: ['Depression', 'Substance use', 'Social isolation', 'Recent loss', 'Chronic illness', 'Financial stress', 'Legal problems', 'Access to means']
                    },
                    {
                        id: 'protective_factors',
                        type: 'checkbox',
                        question: 'Protective Factors',
                        options: ['Strong social support', 'Religious/spiritual beliefs', 'Responsibility to others', 'Future goals', 'Treatment engagement', 'Coping skills']
                    },
                    {
                        id: 'safety_plan',
                        type: 'textarea',
                        question: 'Safety Plan',
                        placeholder: 'Warning signs, coping strategies, support contacts, professional contacts, environmental safety...'
                    },
                    {
                        id: 'risk_level',
                        type: 'radio',
                        question: 'Overall Risk Level',
                        options: ['Low', 'Moderate', 'High', 'Imminent']
                    }
                ]
            },
            'depression': {
                title: 'Depression Assessment (PHQ-9)',
                description: 'Comprehensive depression screening and evaluation',
                questions: [
                    {
                        id: 'phq9_1',
                        type: 'radio',
                        question: 'Little interest or pleasure in doing things',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_2',
                        type: 'radio',
                        question: 'Feeling down, depressed, or hopeless',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_3',
                        type: 'radio',
                        question: 'Trouble falling or staying asleep, or sleeping too much',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_4',
                        type: 'radio',
                        question: 'Feeling tired or having little energy',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_5',
                        type: 'radio',
                        question: 'Poor appetite or overeating',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_6',
                        type: 'radio',
                        question: 'Feeling bad about yourself or that you are a failure',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_7',
                        type: 'radio',
                        question: 'Trouble concentrating on things',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_8',
                        type: 'radio',
                        question: 'Moving or speaking slowly, or being fidgety/restless',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'phq9_9',
                        type: 'radio',
                        question: 'Thoughts of being better off dead or hurting yourself',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'functional_impact',
                        type: 'radio',
                        question: 'How difficult have these problems made it to function?',
                        options: ['Not difficult at all', 'Somewhat difficult', 'Very difficult', 'Extremely difficult']
                    }
                ]
            },
            'anxiety': {
                title: 'Anxiety Assessment (GAD-7)',
                description: 'Generalized anxiety disorder screening',
                questions: [
                    {
                        id: 'gad7_1',
                        type: 'radio',
                        question: 'Feeling nervous, anxious, or on edge',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_2',
                        type: 'radio',
                        question: 'Not being able to stop or control worrying',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_3',
                        type: 'radio',
                        question: 'Worrying too much about different things',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_4',
                        type: 'radio',
                        question: 'Trouble relaxing',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_5',
                        type: 'radio',
                        question: 'Being so restless that it\'s hard to sit still',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_6',
                        type: 'radio',
                        question: 'Becoming easily annoyed or irritable',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'gad7_7',
                        type: 'radio',
                        question: 'Feeling afraid as if something awful might happen',
                        options: ['Not at all (0)', 'Several days (1)', 'More than half the days (2)', 'Nearly every day (3)']
                    },
                    {
                        id: 'anxiety_triggers',
                        type: 'textarea',
                        question: 'Anxiety Triggers',
                        placeholder: 'Describe specific situations, thoughts, or events that trigger anxiety...'
                    },
                    {
                        id: 'coping_strategies',
                        type: 'textarea',
                        question: 'Current Coping Strategies',
                        placeholder: 'How does the client currently manage anxiety symptoms?...'
                    }
                ]
            },
            'substance-use': {
                title: 'Substance Use Assessment',
                description: 'Comprehensive substance use evaluation',
                questions: [
                    {
                        id: 'current_use',
                        type: 'checkbox',
                        question: 'Current Substance Use',
                        options: ['Alcohol', 'Cannabis', 'Cocaine', 'Opioids', 'Stimulants', 'Sedatives', 'Hallucinogens', 'Tobacco', 'Other']
                    },
                    {
                        id: 'frequency',
                        type: 'textarea',
                        question: 'Frequency and Amount',
                        placeholder: 'Describe frequency, amount, and pattern of use for each substance...'
                    },
                    {
                        id: 'age_first_use',
                        type: 'text',
                        question: 'Age of First Use',
                        placeholder: 'Age when substance use began...'
                    },
                    {
                        id: 'consequences',
                        type: 'checkbox',
                        question: 'Consequences of Use',
                        options: ['Legal problems', 'Relationship issues', 'Work/school problems', 'Financial difficulties', 'Health problems', 'Accidents/injuries']
                    },
                    {
                        id: 'withdrawal',
                        type: 'textarea',
                        question: 'Withdrawal Symptoms',
                        placeholder: 'Describe any withdrawal symptoms experienced...'
                    },
                    {
                        id: 'treatment_history',
                        type: 'textarea',
                        question: 'Treatment History',
                        placeholder: 'Previous treatment attempts, outcomes, current motivation for change...'
                    },
                    {
                        id: 'family_history',
                        type: 'textarea',
                        question: 'Family History of Substance Use',
                        placeholder: 'Family history of addiction or substance use disorders...'
                    },
                    {
                        id: 'readiness_change',
                        type: 'radio',
                        question: 'Readiness for Change',
                        options: ['Precontemplation', 'Contemplation', 'Preparation', 'Action', 'Maintenance']
                    }
                ]
            },
            'career': {
                title: 'Comprehensive Career Assessment',
                description: '120-question career interests, skills, and work values evaluation',
                questions: [
                    // Work Interests Section (30 questions)
                    { id: 'interest_1', type: 'radio', question: 'I enjoy working with my hands to build or repair things', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_2', type: 'radio', question: 'I like analyzing data and solving complex problems', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_3', type: 'radio', question: 'I enjoy helping people with their personal problems', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_4', type: 'radio', question: 'I like leading teams and making important decisions', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_5', type: 'radio', question: 'I enjoy creating art, music, or writing', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_6', type: 'radio', question: 'I like working with numbers and financial data', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_7', type: 'radio', question: 'I enjoy teaching or training others', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_8', type: 'radio', question: 'I like working outdoors in nature', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_9', type: 'radio', question: 'I enjoy conducting scientific research', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_10', type: 'radio', question: 'I like organizing events and coordinating activities', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_11', type: 'radio', question: 'I enjoy working with technology and computers', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_12', type: 'radio', question: 'I like providing healthcare or medical services', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_13', type: 'radio', question: 'I enjoy selling products or services to people', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_14', type: 'radio', question: 'I like working with animals', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_15', type: 'radio', question: 'I enjoy designing buildings or spaces', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_16', type: 'radio', question: 'I like working in law enforcement or security', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_17', type: 'radio', question: 'I enjoy cooking or food preparation', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_18', type: 'radio', question: 'I like working in transportation or logistics', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_19', type: 'radio', question: 'I enjoy performing for audiences', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_20', type: 'radio', question: 'I like working in manufacturing or production', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_21', type: 'radio', question: 'I enjoy counseling or therapy work', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_22', type: 'radio', question: 'I like managing finances or investments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_23', type: 'radio', question: 'I enjoy writing or journalism', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_24', type: 'radio', question: 'I like working in hospitality or tourism', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_25', type: 'radio', question: 'I enjoy environmental or conservation work', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_26', type: 'radio', question: 'I like working in sports or fitness', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_27', type: 'radio', question: 'I enjoy working in government or public service', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_28', type: 'radio', question: 'I like working with children or youth', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_29', type: 'radio', question: 'I enjoy working in retail or customer service', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'interest_30', type: 'radio', question: 'I like working in agriculture or farming', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },

                    // Skills Assessment Section (30 questions)
                    { id: 'skill_1', type: 'radio', question: 'I am skilled at using tools and machinery', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_2', type: 'radio', question: 'I am good at mathematical calculations', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_3', type: 'radio', question: 'I am effective at communicating with others', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_4', type: 'radio', question: 'I am skilled at leading and motivating people', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_5', type: 'radio', question: 'I am creative and artistic', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_6', type: 'radio', question: 'I am good at organizing and planning', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_7', type: 'radio', question: 'I am skilled at problem-solving', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_8', type: 'radio', question: 'I am good at working with my hands', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_9', type: 'radio', question: 'I am effective at public speaking', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_10', type: 'radio', question: 'I am skilled at using computers and technology', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_11', type: 'radio', question: 'I am good at listening and understanding others', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_12', type: 'radio', question: 'I am skilled at analyzing information', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_13', type: 'radio', question: 'I am effective at negotiating and persuading', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_14', type: 'radio', question: 'I am good at managing time and priorities', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_15', type: 'radio', question: 'I am skilled at writing and documentation', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_16', type: 'radio', question: 'I am good at working under pressure', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_17', type: 'radio', question: 'I am skilled at teaching and training', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_18', type: 'radio', question: 'I am effective at customer service', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_19', type: 'radio', question: 'I am good at attention to detail', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_20', type: 'radio', question: 'I am skilled at teamwork and collaboration', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_21', type: 'radio', question: 'I am good at physical coordination', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_22', type: 'radio', question: 'I am skilled at research and investigation', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_23', type: 'radio', question: 'I am effective at conflict resolution', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_24', type: 'radio', question: 'I am good at multitasking', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_25', type: 'radio', question: 'I am skilled at decision making', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_26', type: 'radio', question: 'I am good at learning new things quickly', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_27', type: 'radio', question: 'I am skilled at budgeting and financial planning', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_28', type: 'radio', question: 'I am effective at networking and relationship building', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_29', type: 'radio', question: 'I am good at adapting to change', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },
                    { id: 'skill_30', type: 'radio', question: 'I am skilled at quality control and inspection', options: ['Poor', 'Below Average', 'Average', 'Above Average', 'Excellent'] },

                    // Work Values Section (30 questions)
                    { id: 'value_1', type: 'radio', question: 'High salary is very important to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_2', type: 'radio', question: 'Job security and stability matter to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_3', type: 'radio', question: 'Having flexible work hours is important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_4', type: 'radio', question: 'Opportunities for advancement are crucial', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_5', type: 'radio', question: 'Work-life balance is essential to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_6', type: 'radio', question: 'Making a positive impact on society matters', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_7', type: 'radio', question: 'Creative freedom in my work is important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_8', type: 'radio', question: 'Working independently is valuable to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_9', type: 'radio', question: 'Recognition and prestige are important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_10', type: 'radio', question: 'Variety and change in work tasks matter', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_11', type: 'radio', question: 'Working with a team is important to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_12', type: 'radio', question: 'Intellectual challenge is essential', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_13', type: 'radio', question: 'Good benefits package is crucial', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_14', type: 'radio', question: 'Pleasant work environment matters', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_15', type: 'radio', question: 'Helping others is important to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_16', type: 'radio', question: 'Leadership opportunities are valuable', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_17', type: 'radio', question: 'Minimal stress level is important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_18', type: 'radio', question: 'Continuous learning opportunities matter', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_19', type: 'radio', question: 'Location and commute are important factors', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_20', type: 'radio', question: 'Company culture and values matter to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_21', type: 'radio', question: 'Having authority and power is important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_22', type: 'radio', question: 'Routine and predictability are valuable', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_23', type: 'radio', question: 'Travel opportunities are appealing', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_24', type: 'radio', question: 'Working with cutting-edge technology matters', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_25', type: 'radio', question: 'Ethical work practices are crucial', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_26', type: 'radio', question: 'Physical activity in work is important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_27', type: 'radio', question: 'Mentoring others is valuable to me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_28', type: 'radio', question: 'Competition and achievement drive me', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_29', type: 'radio', question: 'Diversity and inclusion are important', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },
                    { id: 'value_30', type: 'radio', question: 'Retirement and long-term benefits matter', options: ['Not Important', 'Slightly Important', 'Moderately Important', 'Very Important', 'Extremely Important'] },

                    // Work Environment Preferences (30 questions)
                    { id: 'environment_1', type: 'radio', question: 'I prefer working in an office setting', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_2', type: 'radio', question: 'I enjoy working from home or remotely', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_3', type: 'radio', question: 'I like working in a fast-paced environment', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_4', type: 'radio', question: 'I prefer a quiet, calm workplace', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_5', type: 'radio', question: 'I enjoy working in large organizations', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_6', type: 'radio', question: 'I prefer small, intimate work settings', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_7', type: 'radio', question: 'I like working with deadlines and time pressure', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_8', type: 'radio', question: 'I prefer structured, organized workplaces', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_9', type: 'radio', question: 'I enjoy collaborative, team-oriented environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_10', type: 'radio', question: 'I prefer working alone most of the time', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_11', type: 'radio', question: 'I like working in creative, innovative environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_12', type: 'radio', question: 'I prefer traditional, established workplaces', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_13', type: 'radio', question: 'I enjoy working with diverse groups of people', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_14', type: 'radio', question: 'I prefer working with people similar to me', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_15', type: 'radio', question: 'I like workplaces with frequent social interaction', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_16', type: 'radio', question: 'I prefer minimal social interaction at work', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_17', type: 'radio', question: 'I enjoy working in competitive environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_18', type: 'radio', question: 'I prefer cooperative, supportive workplaces', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_19', type: 'radio', question: 'I like working in high-tech environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_20', type: 'radio', question: 'I prefer low-tech, traditional work methods', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_21', type: 'radio', question: 'I enjoy working in customer-facing roles', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_22', type: 'radio', question: 'I prefer behind-the-scenes work', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_23', type: 'radio', question: 'I like working in formal, professional settings', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_24', type: 'radio', question: 'I prefer casual, relaxed work environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_25', type: 'radio', question: 'I enjoy working in international or global settings', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_26', type: 'radio', question: 'I prefer local, community-focused work', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_27', type: 'radio', question: 'I like working in results-oriented environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_28', type: 'radio', question: 'I prefer process-oriented workplaces', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_29', type: 'radio', question: 'I enjoy working in entrepreneurial environments', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] },
                    { id: 'environment_30', type: 'radio', question: 'I prefer stable, established organizations', options: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] }
                ]
            }
        };

        // Authentication System
        class AuthSystem {
            constructor() {
                this.isAuthenticated = false;
                this.sessionStart = null;
                this.failedAttempts = parseInt(localStorage.getItem('pswFailedAttempts') || '0');
                this.lockoutUntil = parseInt(localStorage.getItem('pswLockoutUntil') || '0');
            }
            
            isLockedOut() {
                return Date.now() < this.lockoutUntil;
            }
            
            authenticate(passcode) {
                if (this.isLockedOut()) {
                    const remainingTime = Math.ceil((this.lockoutUntil - Date.now()) / 60000);
                    throw new Error(`Account locked. Try again in ${remainingTime} minutes.`);
                }
                
                // Secure credentials for Pratik Sutar
                const correctPasscode = localStorage.getItem('pswPasscode') || 'chikupratik';
                
                if (passcode === correctPasscode) {
                    this.isAuthenticated = true;
                    this.sessionStart = Date.now();
                    this.failedAttempts = 0;
                    localStorage.removeItem('pswFailedAttempts');
                    localStorage.removeItem('pswLockoutUntil');
                    return true;
                } else {
                    this.failedAttempts++;
                    localStorage.setItem('pswFailedAttempts', this.failedAttempts.toString());
                    
                    if (this.failedAttempts >= SECURITY_CONFIG.maxFailedAttempts) {
                        this.lockoutUntil = Date.now() + SECURITY_CONFIG.lockoutDuration;
                        localStorage.setItem('pswLockoutUntil', this.lockoutUntil.toString());
                        throw new Error(`Too many failed attempts. Account locked for 15 minutes.`);
                    }
                    
                    throw new Error(`Incorrect passcode. ${SECURITY_CONFIG.maxFailedAttempts - this.failedAttempts} attempts remaining.`);
                }
            }
            
            isSessionValid() {
                if (!this.isAuthenticated || !this.sessionStart) return false;
                return (Date.now() - this.sessionStart) < SECURITY_CONFIG.sessionTimeout;
            }
            
            logout() {
                this.isAuthenticated = false;
                this.sessionStart = null;
                showLoginScreen();
            }
            
            extendSession() {
                if (this.isAuthenticated) {
                    this.sessionStart = Date.now();
                }
            }
        }
        
        const authSystem = new AuthSystem();
        
        // Network Manager for WiFi and Mobile Data Detection
        class NetworkManager {
            constructor() {
                this.connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                this.isOnline = navigator.onLine;
                this.connectionType = 'unknown';
                this.effectiveType = 'unknown';
                this.downlink = 0;
                this.rtt = 0;
                this.saveData = false;
                this.listeners = [];
                
                this.init();
            }
            
            init() {
                this.updateConnectionInfo();
                this.setupEventListeners();
            }
            
            updateConnectionInfo() {
                if (this.connection) {
                    this.connectionType = this.connection.type || 'unknown';
                    this.effectiveType = this.connection.effectiveType || 'unknown';
                    this.downlink = this.connection.downlink || 0;
                    this.rtt = this.connection.rtt || 0;
                    this.saveData = this.connection.saveData || false;
                }
                this.isOnline = navigator.onLine;
            }
            
            setupEventListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateConnectionInfo();
                    this.notifyListeners('online');
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.notifyListeners('offline');
                });
                
                if (this.connection) {
                    this.connection.addEventListener('change', () => {
                        this.updateConnectionInfo();
                        this.notifyListeners('change');
                    });
                }
            }
            
            addListener(callback) {
                this.listeners.push(callback);
            }
            
            removeListener(callback) {
                this.listeners = this.listeners.filter(listener => listener !== callback);
            }
            
            notifyListeners(event) {
                this.listeners.forEach(callback => callback(event, this.getConnectionInfo()));
            }
            
            getConnectionInfo() {
                return {
                    isOnline: this.isOnline,
                    type: this.connectionType,
                    effectiveType: this.effectiveType,
                    downlink: this.downlink,
                    rtt: this.rtt,
                    saveData: this.saveData,
                    isWiFi: this.isWiFi(),
                    isMobile: this.isMobileData(),
                    isGoodConnection: this.isGoodConnection(),
                    connectionQuality: this.getConnectionQuality()
                };
            }
            
            isWiFi() {
                return this.connectionType === 'wifi' || 
                       (this.connectionType === 'unknown' && this.effectiveType === '4g' && this.downlink > 5);
            }
            
            isMobileData() {
                return ['cellular', '2g', '3g', '4g', '5g'].includes(this.connectionType) ||
                       (this.connectionType === 'unknown' && this.effectiveType !== 'slow-2g' && !this.isWiFi());
            }
            
            isGoodConnection() {
                return this.isOnline && 
                       this.effectiveType !== 'slow-2g' && 
                       this.downlink > 0.5 && 
                       this.rtt < 2000;
            }
            
            getConnectionQuality() {
                if (!this.isOnline) return 'offline';
                if (this.effectiveType === 'slow-2g') return 'poor';
                if (this.effectiveType === '2g') return 'slow';
                if (this.effectiveType === '3g') return 'moderate';
                if (this.effectiveType === '4g' && this.downlink > 5) return 'excellent';
                if (this.effectiveType === '4g') return 'good';
                return 'unknown';
            }
            
            shouldAllowSync() {
                const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
                
                if (!this.isOnline) return false;
                if (!settings.autoSyncEnabled) return false;
                
                if (this.isWiFi() && settings.syncOnWifi !== false) return true;
                if (this.isMobileData() && settings.syncOnMobile === true) return true;
                
                return false;
            }
            
            getDataUsageWarning() {
                if (this.isMobileData() && this.saveData) {
                    return 'Data Saver mode detected. Sync may be limited.';
                }
                if (this.isMobileData() && this.effectiveType === '3g') {
                    return 'Slow mobile connection. Sync may take longer.';
                }
                return null;
            }
        }
        
        const networkManager = new NetworkManager();

        // Mobile App Features
        class MobileAppManager {
            constructor() {
                this.installPrompt = null;
                this.isInstalled = MOBILE_CONFIG.isStandalone;
                this.networkManager = networkManager;
            }
            
            init() {
                this.setupPWA();
                this.setupMobileOptimizations();
                this.setupOfflineMode();
                if (MOBILE_CONFIG.enablePushNotifications) {
                    this.setupPushNotifications();
                }
            }
            
            setupPWA() {
                // Listen for install prompt
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.installPrompt = e;
                    this.showInstallButton();
                });
                
                // Check if already installed
                window.addEventListener('appinstalled', () => {
                    this.isInstalled = true;
                    this.hideInstallButton();
                    showNotification('📱 App installed successfully!', 'success');
                });
            }
            
            async installApp() {
                if (!this.installPrompt) {
                    showNotification('Install not available. Use browser menu to add to home screen.', 'info');
                    return;
                }
                
                const result = await this.installPrompt.prompt();
                if (result.outcome === 'accepted') {
                    showNotification('📱 Installing app...', 'success');
                } else {
                    showNotification('Installation cancelled', 'info');
                }
                this.installPrompt = null;
            }
            
            showInstallButton() {
                const installBtn = document.getElementById('install-app-btn');
                if (installBtn) installBtn.classList.remove('hidden');
            }
            
            hideInstallButton() {
                const installBtn = document.getElementById('install-app-btn');
                if (installBtn) installBtn.classList.add('hidden');
            }
            
            setupMobileOptimizations() {
                if (MOBILE_CONFIG.isMobile) {
                    // Add mobile-specific styles
                    document.body.classList.add('mobile-optimized');
                    
                    // Prevent zoom on input focus
                    const inputs = document.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        input.addEventListener('focus', () => {
                            document.querySelector('meta[name=viewport]').setAttribute('content', 
                                'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                        });
                        input.addEventListener('blur', () => {
                            document.querySelector('meta[name=viewport]').setAttribute('content', 
                                'width=device-width, initial-scale=1.0');
                        });
                    });
                }
            }
            
            setupOfflineMode() {
                if ('serviceWorker' in navigator && MOBILE_CONFIG.enableOfflineMode) {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.log('SW registered:', registration);
                        })
                        .catch(error => {
                            console.log('SW registration failed:', error);
                        });
                }
            }
            
            async setupPushNotifications() {
                if ('Notification' in window && 'serviceWorker' in navigator) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        console.log('Push notifications enabled');
                    }
                }
            }
        }
        
        const mobileApp = new MobileAppManager();
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (SECURITY_CONFIG.requireAuth) {
                showLoginScreen();
            } else {
                initializeApp();
            }
            
            mobileApp.init();
            
            // Setup network event listeners
            networkManager.addListener((event, connectionInfo) => {
                checkConnectionStatus();
                
                if (event === 'online') {
                    const connectionType = connectionInfo.isWiFi ? 'WiFi' : connectionInfo.isMobile ? 'Mobile Data' : 'Network';
                    showNotification(`🌐 Connected to ${connectionType}`, 'success');
                    
                    // Try to sync pending emails after coming online
                    setTimeout(() => {
                        if (autoSyncEnabled) {
                            processPendingEmails();
                        }
                    }, 2000);
                } else if (event === 'offline') {
                    showNotification('📵 Connection lost - working offline', 'warning');
                } else if (event === 'change') {
                    const connectionType = connectionInfo.isWiFi ? 'WiFi' : connectionInfo.isMobile ? 'Mobile Data' : 'Network';
                    console.log(`Network changed to: ${connectionType} (${connectionInfo.effectiveType})`);
                    
                    // Show notification for significant connection changes
                    if (connectionInfo.isWiFi) {
                        showNotification('📶 Switched to WiFi - sync enabled', 'info');
                    } else if (connectionInfo.isMobile && connectionInfo.connectionQuality === 'poor') {
                        showNotification('📱 Slow mobile connection detected', 'warning');
                    }
                }
            });
            
            // Session timeout check
            setInterval(() => {
                if (authSystem.isAuthenticated && !authSystem.isSessionValid()) {
                    showNotification('Session expired. Please log in again.', 'warning');
                    authSystem.logout();
                }
            }, 60000); // Check every minute
        });
        
        function initializeApp() {
            updateCurrentDate();
            loadSettings();
            updateStats();
            loadRecentAssessments();
            initializeAutoSync();
            checkConnectionStatus();
            updatePendingCount();
            
            // Extend session on user activity
            document.addEventListener('click', () => authSystem.extendSession());
            document.addEventListener('keypress', () => authSystem.extendSession());
        }

        function updateCurrentDate() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString();
            
            // Set default session date to today
            const sessionDateInput = document.getElementById('session-date');
            if (sessionDateInput) {
                sessionDateInput.value = now.toISOString().split('T')[0];
            }
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
            if (settings.practitionerName) {
                document.getElementById('practitioner-name').value = settings.practitionerName;
            }
            if (settings.licenseNumber) {
                document.getElementById('license-number').value = settings.licenseNumber;
            }
            if (settings.practitionerEmail) {
                document.getElementById('practitioner-email').value = settings.practitionerEmail;
            }
            if (settings.practiceName) {
                document.getElementById('practice-name').value = settings.practiceName;
            }
            
            // Load sync settings
            document.getElementById('auto-sync-enabled').checked = settings.autoSyncEnabled !== false;
            document.getElementById('sync-on-wifi').checked = settings.syncOnWifi !== false;
            document.getElementById('sync-on-mobile').checked = settings.syncOnMobile === true;
            document.getElementById('sync-on-slow-connection').checked = settings.syncOnSlowConnection === true;
        }

        function saveSettings() {
            const settings = {
                practitionerName: document.getElementById('practitioner-name').value,
                licenseNumber: document.getElementById('license-number').value,
                practitionerEmail: document.getElementById('practitioner-email').value,
                practiceName: document.getElementById('practice-name').value,
                autoSyncEnabled: document.getElementById('auto-sync-enabled').checked,
                syncOnWifi: document.getElementById('sync-on-wifi').checked,
                syncOnMobile: document.getElementById('sync-on-mobile').checked,
                syncOnSlowConnection: document.getElementById('sync-on-slow-connection').checked
            };
            
            // Handle passcode change
            const newPasscode = document.getElementById('new-passcode').value;
            if (newPasscode.trim()) {
                if (newPasscode.length < 4) {
                    showNotification('Passcode must be at least 4 characters long', 'error');
                    return;
                }
                localStorage.setItem('pswPasscode', newPasscode);
                document.getElementById('new-passcode').value = '';
                showNotification('Passcode updated successfully!', 'success');
            }
            
            secureStorage.setItem('pswSettings', settings);
            autoSyncEnabled = settings.autoSyncEnabled;
            closeModal('settings-modal');
            showNotification('Settings saved successfully!', 'success');
            
            // Try to sync pending emails if auto-sync is enabled
            if (settings.autoSyncEnabled) {
                setTimeout(processPendingEmails, 1000);
            }
        }
        
        // Login and Security Functions
        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('login-screen').classList.add('login-fade-in');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('assessment-interface').classList.add('hidden');
            document.getElementById('report-view').classList.add('hidden');
            
            // Focus on passcode input
            setTimeout(() => {
                document.getElementById('passcode-input').focus();
            }, 100);
            
            // Check if locked out
            if (authSystem.isLockedOut()) {
                const remainingTime = Math.ceil((authSystem.lockoutUntil - Date.now()) / 60000);
                document.getElementById('lockout-message').textContent = `Account locked. Try again in ${remainingTime} minutes.`;
                document.getElementById('lockout-message').classList.remove('hidden');
                document.getElementById('login-btn').disabled = true;
                
                // Update countdown
                const countdown = setInterval(() => {
                    const remaining = Math.ceil((authSystem.lockoutUntil - Date.now()) / 60000);
                    if (remaining <= 0) {
                        clearInterval(countdown);
                        document.getElementById('lockout-message').classList.add('hidden');
                        document.getElementById('login-btn').disabled = false;
                    } else {
                        document.getElementById('lockout-message').textContent = `Account locked. Try again in ${remaining} minutes.`;
                    }
                }, 1000);
            }
        }
        
        function hideLoginScreen() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }
        
        function showPasscodeHelp() {
            document.getElementById('passcode-help-modal').classList.remove('hidden');
        }
        
        // Login form handler
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const passcode = document.getElementById('passcode-input').value;
                    const errorDiv = document.getElementById('login-error');
                    
                    try {
                        if (authSystem.authenticate(passcode)) {
                            hideLoginScreen();
                            initializeApp();
                            showNotification('🔓 Welcome back! Logged in successfully.', 'success');
                            document.getElementById('passcode-input').value = '';
                            errorDiv.classList.add('hidden');
                        }
                    } catch (error) {
                        errorDiv.textContent = error.message;
                        errorDiv.classList.remove('hidden');
                        document.getElementById('passcode-input').value = '';
                        
                        // Shake animation for error
                        const loginBtn = document.getElementById('login-btn');
                        loginBtn.style.animation = 'shake 0.5s';
                        setTimeout(() => {
                            loginBtn.style.animation = '';
                        }, 500);
                        
                        if (error.message.includes('locked')) {
                            document.getElementById('login-btn').disabled = true;
                            showLoginScreen(); // Refresh to show lockout countdown
                        }
                    }
                });
            }
        });

        function updateStats() {
            const today = new Date().toDateString();
            const thisWeek = getWeekStart(new Date());
            
            let todayCount = 0;
            let weekCount = 0;
            let totalClients = new Set();
            
            completedAssessments.forEach(assessment => {
                const assessmentDate = new Date(assessment.completedDate).toDateString();
                const assessmentWeek = getWeekStart(new Date(assessment.completedDate));
                
                if (assessmentDate === today) todayCount++;
                if (assessmentWeek.getTime() === thisWeek.getTime()) weekCount++;
                totalClients.add(assessment.clientName);
            });
            
            document.getElementById('today-count').textContent = todayCount;
            document.getElementById('week-count').textContent = weekCount;
            document.getElementById('total-clients').textContent = totalClients.size;
            document.getElementById('reports-count').textContent = completedAssessments.length;
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }

        function loadRecentAssessments() {
            const container = document.getElementById('recent-assessments-list');
            
            if (completedAssessments.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center py-8">No assessments completed yet. Start your first assessment above!</p>';
                return;
            }
            
            const recentAssessments = completedAssessments.slice(-5).reverse();
            
            container.innerHTML = recentAssessments.map(assessment => `
                <div class="border-b last:border-b-0 py-4 flex justify-between items-center">
                    <div>
                        <h3 class="font-semibold">${assessment.clientName}</h3>
                        <p class="text-sm text-gray-600">${assessment.assessmentTitle}</p>
                        <p class="text-xs text-gray-500">${new Date(assessment.completedDate).toLocaleDateString()}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="viewReport('${assessment.id}')" class="px-3 py-1 bg-blue-100 text-blue-800 text-xs rounded-lg hover:bg-blue-200">
                            View Report
                        </button>
                        <button onclick="emailReport('${assessment.id}')" class="px-3 py-1 bg-green-100 text-green-800 text-xs rounded-lg hover:bg-green-200">
                            Email
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function startAssessment(type) {
            currentAssessment = assessmentTemplates[type];
            currentQuestionIndex = 0;
            assessmentResponses = {};
            
            // Show assessment interface
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('assessment-interface').classList.remove('hidden');
            
            // Set assessment info
            document.getElementById('assessment-title').textContent = currentAssessment.title;
            document.getElementById('assessment-description').textContent = currentAssessment.description;
            document.getElementById('total-questions').textContent = currentAssessment.questions.length;
            
            // Load first question
            loadQuestion();
            updateProgress();
        }

        function loadQuestion() {
            const question = currentAssessment.questions[currentQuestionIndex];
            const container = document.getElementById('question-container');
            
            let questionHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">${question.question}</h3>
            `;
            
            switch (question.type) {
                case 'textarea':
                    questionHTML += `
                        <textarea id="response-${question.id}" rows="4" placeholder="${question.placeholder || ''}" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">${assessmentResponses[question.id] || ''}</textarea>
                    `;
                    break;
                    
                case 'text':
                    questionHTML += `
                        <input type="text" id="response-${question.id}" placeholder="${question.placeholder || ''}" 
                               value="${assessmentResponses[question.id] || ''}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    `;
                    break;
                    
                case 'select':
                    questionHTML += `
                        <select id="response-${question.id}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Select an option...</option>
                            ${question.options.map(option => `
                                <option value="${option}" ${assessmentResponses[question.id] === option ? 'selected' : ''}>${option}</option>
                            `).join('')}
                        </select>
                    `;
                    break;
                    
                case 'radio':
                    questionHTML += `
                        <div class="space-y-2">
                            ${question.options.map(option => `
                                <label class="flex items-center">
                                    <input type="radio" name="response-${question.id}" value="${option}" 
                                           ${assessmentResponses[question.id] === option ? 'checked' : ''}
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'checkbox':
                    const selectedValues = assessmentResponses[question.id] || [];
                    questionHTML += `
                        <div class="space-y-2">
                            ${question.options.map(option => `
                                <label class="flex items-center">
                                    <input type="checkbox" name="response-${question.id}" value="${option}" 
                                           ${selectedValues.includes(option) ? 'checked' : ''}
                                           class="mr-2 text-blue-600 focus:ring-blue-500">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    break;
            }
            
            questionHTML += '</div>';
            container.innerHTML = questionHTML;
            
            // Add event listeners to save responses
            const responseElement = document.getElementById(`response-${question.id}`);
            if (responseElement) {
                if (question.type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[name="response-${question.id}"]`);
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', saveCurrentResponse);
                    });
                } else if (question.type === 'radio') {
                    const radios = document.querySelectorAll(`input[name="response-${question.id}"]`);
                    radios.forEach(radio => {
                        radio.addEventListener('change', saveCurrentResponse);
                    });
                } else {
                    responseElement.addEventListener('input', saveCurrentResponse);
                }
            }
        }

        function saveCurrentResponse() {
            const question = currentAssessment.questions[currentQuestionIndex];
            
            if (question.type === 'checkbox') {
                const checkboxes = document.querySelectorAll(`input[name="response-${question.id}"]:checked`);
                assessmentResponses[question.id] = Array.from(checkboxes).map(cb => cb.value);
            } else if (question.type === 'radio') {
                const radio = document.querySelector(`input[name="response-${question.id}"]:checked`);
                assessmentResponses[question.id] = radio ? radio.value : '';
            } else {
                const element = document.getElementById(`response-${question.id}`);
                assessmentResponses[question.id] = element ? element.value : '';
            }
        }

        function nextQuestion() {
            saveCurrentResponse();
            
            if (currentQuestionIndex < currentAssessment.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                updateProgress();
            }
        }

        function previousQuestion() {
            saveCurrentResponse();
            
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentAssessment.questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('progress-percentage').textContent = `${Math.round(progress)}%`;
            
            // Update button states
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentAssessment.questions.length - 1) {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('complete-btn').classList.remove('hidden');
            } else {
                document.getElementById('next-btn').classList.remove('hidden');
                document.getElementById('complete-btn').classList.add('hidden');
            }
        }

        function completeAssessment() {
            saveCurrentResponse();
            
            // Validate required client information
            const clientName = document.getElementById('client-name').value;
            const clientDOB = document.getElementById('client-dob').value;
            const sessionDate = document.getElementById('session-date').value;
            
            if (!clientName || !sessionDate) {
                showNotification('Please fill in client name and session date', 'error');
                return;
            }
            
            // Create assessment record
            const assessmentRecord = {
                id: Date.now().toString(),
                assessmentType: Object.keys(assessmentTemplates).find(key => assessmentTemplates[key] === currentAssessment),
                assessmentTitle: currentAssessment.title,
                clientName: clientName,
                clientDOB: clientDOB,
                clientId: document.getElementById('client-id').value,
                sessionDate: sessionDate,
                completedDate: new Date().toISOString(),
                responses: assessmentResponses
            };
            
            // Save to localStorage
            completedAssessments.push(assessmentRecord);
            localStorage.setItem('completedAssessments', JSON.stringify(completedAssessments));
            
            // Generate and show report
            generateReport(assessmentRecord);
            
            // Update stats
            updateStats();
            loadRecentAssessments();
            
            showNotification('Assessment completed successfully!', 'success');
            
            // Auto-queue for email if enabled
            if (autoSyncEnabled) {
                queueEmailReport(assessmentRecord);
            }
        }
        
        // Auto-Sync System Functions
        function initializeAutoSync() {
            // Check connection status every 30 seconds
            setInterval(checkConnectionStatus, 30000);
            
            // Try to process pending emails every 2 minutes
            setInterval(() => {
                if (autoSyncEnabled) {
                    processPendingEmails();
                }
            }, 120000);
            
            // Listen for online/offline events
            window.addEventListener('online', () => {
                checkConnectionStatus();
                if (autoSyncEnabled) {
                    setTimeout(processPendingEmails, 2000);
                }
            });
            
            window.addEventListener('offline', checkConnectionStatus);
        }
        
        function checkConnectionStatus() {
            const connectionInfo = networkManager.getConnectionInfo();
            const connectionDot = document.getElementById('connection-dot');
            const connectionText = document.getElementById('connection-text');
            
            if (!connectionInfo.isOnline) {
                connectionDot.className = 'w-2 h-2 rounded-full bg-red-500 mr-1';
                connectionText.textContent = 'Offline';
            } else {
                // Determine connection type and quality
                let dotColor = 'bg-green-500';
                let textContent = 'Online';
                
                if (connectionInfo.isWiFi) {
                    dotColor = 'bg-green-500';
                    textContent = `📶 WiFi (${connectionInfo.effectiveType.toUpperCase()})`;
                } else if (connectionInfo.isMobile) {
                    if (connectionInfo.connectionQuality === 'excellent') {
                        dotColor = 'bg-green-500';
                        textContent = `📱 Mobile (${connectionInfo.effectiveType.toUpperCase()})`;
                    } else if (connectionInfo.connectionQuality === 'good') {
                        dotColor = 'bg-blue-500';
                        textContent = `📱 Mobile (${connectionInfo.effectiveType.toUpperCase()})`;
                    } else if (connectionInfo.connectionQuality === 'moderate') {
                        dotColor = 'bg-yellow-500';
                        textContent = `📱 Mobile (${connectionInfo.effectiveType.toUpperCase()})`;
                    } else {
                        dotColor = 'bg-orange-500';
                        textContent = `📱 Mobile (${connectionInfo.effectiveType.toUpperCase()})`;
                    }
                } else {
                    dotColor = connectionInfo.isGoodConnection ? 'bg-green-500' : 'bg-yellow-500';
                    textContent = `Online (${connectionInfo.effectiveType.toUpperCase()})`;
                }
                
                connectionDot.className = `w-2 h-2 rounded-full ${dotColor} mr-1`;
                connectionText.textContent = textContent;
                
                // Show data usage warning if applicable
                const warning = networkManager.getDataUsageWarning();
                if (warning) {
                    connectionText.title = warning;
                }
            }
            
            updatePendingCount();
            updateNetworkStatusInSettings();
        }
        
        function updateNetworkStatusInSettings() {
            const connectionInfo = networkManager.getConnectionInfo();
            const networkStatusElement = document.getElementById('network-status-display');
            
            if (networkStatusElement) {
                let statusHTML = `
                    <div class="bg-white p-3 rounded-lg border">
                        <h4 class="font-semibold mb-2">📡 Current Network Status</h4>
                        <div class="text-sm space-y-1">
                            <div><strong>Status:</strong> ${connectionInfo.isOnline ? '🟢 Online' : '🔴 Offline'}</div>
                            ${connectionInfo.isOnline ? `
                                <div><strong>Type:</strong> ${connectionInfo.isWiFi ? '📶 WiFi' : connectionInfo.isMobile ? '📱 Mobile Data' : '🌐 Unknown'}</div>
                                <div><strong>Quality:</strong> ${connectionInfo.connectionQuality.charAt(0).toUpperCase() + connectionInfo.connectionQuality.slice(1)}</div>
                                <div><strong>Speed:</strong> ${connectionInfo.effectiveType.toUpperCase()}</div>
                                ${connectionInfo.downlink > 0 ? `<div><strong>Bandwidth:</strong> ${connectionInfo.downlink} Mbps</div>` : ''}
                                ${connectionInfo.rtt > 0 ? `<div><strong>Latency:</strong> ${connectionInfo.rtt}ms</div>` : ''}
                                ${connectionInfo.saveData ? '<div><strong>⚠️ Data Saver:</strong> Enabled</div>' : ''}
                            ` : ''}
                        </div>
                    </div>
                `;
                networkStatusElement.innerHTML = statusHTML;
            }
        }
        
        function queueEmailReport(assessment) {
            const emailData = {
                id: assessment.id,
                clientName: assessment.clientName,
                assessmentTitle: assessment.assessmentTitle,
                completedDate: assessment.completedDate,
                queuedAt: new Date().toISOString()
            };
            
            pendingEmailQueue.push(emailData);
            localStorage.setItem('pendingEmailQueue', JSON.stringify(pendingEmailQueue));
            updatePendingCount();
            
            showNotification('📧 Report queued for auto-sync when online', 'info');
            
            // Try to send immediately if online
            setTimeout(processPendingEmails, 1000);
        }
        
        function processPendingEmails() {
            if (pendingEmailQueue.length === 0) {
                return;
            }
            
            const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
            if (!settings.autoSyncEnabled) {
                return;
            }
            
            // Use network manager to check if sync should proceed
            if (!networkManager.shouldAllowSync()) {
                const connectionInfo = networkManager.getConnectionInfo();
                if (!connectionInfo.isOnline) {
                    return; // Offline
                }
                
                // Check specific connection preferences
                if (connectionInfo.isWiFi && !settings.syncOnWifi) {
                    return; // WiFi disabled
                }
                
                if (connectionInfo.isMobile && !settings.syncOnMobile) {
                    return; // Mobile data disabled
                }
                
                if (connectionInfo.connectionQuality === 'poor' && !settings.syncOnSlowConnection) {
                    return; // Slow connection and not allowed
                }
                
                return; // Other reasons to not sync
            }
            
            // Show data usage warning if on mobile
            const connectionInfo = networkManager.getConnectionInfo();
            const warning = networkManager.getDataUsageWarning();
            if (warning && connectionInfo.isMobile) {
                console.log('Sync proceeding with warning:', warning);
            }
            
            // Process pending emails
            const emailsToProcess = [...pendingEmailQueue];
            pendingEmailQueue = [];
            localStorage.setItem('pendingEmailQueue', JSON.stringify(pendingEmailQueue));
            
            emailsToProcess.forEach(emailData => {
                const assessment = completedAssessments.find(a => a.id === emailData.id);
                if (assessment) {
                    sendEmailReport(assessment, true);
                }
            });
            
            if (emailsToProcess.length > 0) {
                const connectionType = connectionInfo.isWiFi ? 'WiFi' : connectionInfo.isMobile ? 'Mobile Data' : 'Network';
                showNotification(`📧 ${emailsToProcess.length} reports synced via ${connectionType}!`, 'success');
            }
            
            updatePendingCount();
        }
        
        function sendEmailReport(assessment, isAutoSync = false) {
            const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
            const email = settings.practitionerEmail || 'your.email@example.com';
            
            const subject = `${isAutoSync ? '[AUTO-SYNC] ' : ''}Assessment Report - ${assessment.clientName} - ${assessment.assessmentTitle}`;
            const body = `Assessment completed on ${new Date(assessment.completedDate).toLocaleDateString()}

Client: ${assessment.clientName}
Assessment: ${assessment.assessmentTitle}
Completed: ${new Date(assessment.completedDate).toLocaleString()}

${isAutoSync ? 'This report was automatically synced when internet connection was detected.' : ''}

Generated by PSW Assessment Suite
Clinician: ${settings.practitionerName || 'Not specified'}
License: ${settings.licenseNumber || 'Not specified'}

---
This is an automated notification from your PSW Assessment Suite.`;
            
            window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            if (!isAutoSync) {
                showNotification('Email client opened with report details', 'success');
            }
        }
        
        function forceSyncNow() {
            const connectionInfo = networkManager.getConnectionInfo();
            
            if (!connectionInfo.isOnline) {
                showNotification('❌ No internet connection available', 'error');
                return;
            }
            
            if (pendingEmailQueue.length === 0) {
                showNotification('✅ No pending reports to sync', 'info');
                return;
            }
            
            // Show connection type in notification
            const connectionType = connectionInfo.isWiFi ? 'WiFi' : connectionInfo.isMobile ? 'Mobile Data' : 'Network';
            showNotification(`🔄 Force syncing via ${connectionType}...`, 'info');
            
            // Temporarily override settings for force sync
            const originalSettings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
            const tempSettings = {
                ...originalSettings,
                autoSyncEnabled: true,
                syncOnWifi: true,
                syncOnMobile: true,
                syncOnSlowConnection: true
            };
            localStorage.setItem('pswSettings', JSON.stringify(tempSettings));
            
            processPendingEmails();
            
            // Restore original settings
            localStorage.setItem('pswSettings', JSON.stringify(originalSettings));
        }
        
        function testNetworkSpeed() {
            const connectionInfo = networkManager.getConnectionInfo();
            
            if (!connectionInfo.isOnline) {
                showNotification('❌ No internet connection to test', 'error');
                return;
            }
            
            showNotification('🧪 Testing network speed...', 'info');
            
            // Simple speed test using a small image download
            const startTime = performance.now();
            const testImage = new Image();
            
            testImage.onload = function() {
                const endTime = performance.now();
                const duration = endTime - startTime;
                const connectionType = connectionInfo.isWiFi ? 'WiFi' : connectionInfo.isMobile ? 'Mobile Data' : 'Network';
                
                let speedRating = 'Unknown';
                if (duration < 100) speedRating = 'Excellent';
                else if (duration < 300) speedRating = 'Good';
                else if (duration < 1000) speedRating = 'Fair';
                else speedRating = 'Slow';
                
                showNotification(`📊 Speed Test: ${speedRating} (${Math.round(duration)}ms) via ${connectionType}`, 'success');
                updateNetworkStatusInSettings();
            };
            
            testImage.onerror = function() {
                showNotification('❌ Speed test failed - connection issues', 'error');
            };
            
            // Use a small test image (you can replace with your own)
            testImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7?' + Math.random();
        }
        
        function updatePendingCount() {
            const count = pendingEmailQueue.length;
            const badge = document.getElementById('pending-sync-badge');
            const countElement = document.getElementById('pending-sync-count');
            const settingsCount = document.getElementById('pending-count');
            
            if (countElement) countElement.textContent = count;
            if (settingsCount) settingsCount.textContent = count;
            
            if (badge) {
                if (count > 0) {
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        function generateReport(assessment) {
            const reportContent = document.getElementById('report-content');
            const reportDate = document.getElementById('report-date');
            const printDate = document.getElementById('print-date');
            
            const now = new Date();
            reportDate.textContent = now.toLocaleDateString();
            printDate.textContent = now.toLocaleDateString();
            
            let reportHTML = `
                <div class="space-y-6">
                    <!-- Client Information -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h2 class="text-xl font-bold mb-4">Client Information</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div><strong>Name:</strong> ${assessment.clientName}</div>
                            <div><strong>Date of Birth:</strong> ${assessment.clientDOB || 'Not provided'}</div>
                            <div><strong>Client ID:</strong> ${assessment.clientId || 'Not provided'}</div>
                            <div><strong>Session Date:</strong> ${new Date(assessment.sessionDate).toLocaleDateString()}</div>
                        </div>
                    </div>
                    
                    <!-- Assessment Results -->
                    <div>
                        <h2 class="text-xl font-bold mb-4">${assessment.assessmentTitle} Results</h2>
            `;
            
            // Generate specific report content based on assessment type
            if (assessment.assessmentType === 'depression') {
                reportHTML += generateDepressionReport(assessment.responses);
            } else if (assessment.assessmentType === 'anxiety') {
                reportHTML += generateAnxietyReport(assessment.responses);
            } else if (assessment.assessmentType === 'career') {
                reportHTML += generateCareerReport(assessment.responses);
            } else {
                reportHTML += generateGenericReport(assessment.responses);
            }
            
            reportHTML += `
                    </div>
                    
                    <!-- Psychosocial Issues Identified -->
                    <div class="bg-red-50 p-6 rounded-lg border-l-4 border-red-500">
                        <h2 class="text-xl font-bold mb-4">🎯 Psychosocial Issues Identified</h2>
                        <div id="psychosocial-issues">
                            ${generatePsychosocialIssues(assessment)}
                        </div>
                    </div>
                    
                    <!-- Clinical Interventions Provided -->
                    <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500">
                        <h2 class="text-xl font-bold mb-4">🛠️ Clinical Interventions Provided</h2>
                        <div id="clinical-interventions">
                            ${generateClinicalInterventions(assessment)}
                        </div>
                    </div>
                    
                    <!-- Case Management Activities -->
                    <div class="bg-purple-50 p-6 rounded-lg border-l-4 border-purple-500">
                        <h2 class="text-xl font-bold mb-4">📋 Case Management & Coordination</h2>
                        <div id="case-management">
                            ${generateCaseManagement(assessment)}
                        </div>
                    </div>
                    
                    <!-- Treatment Plan & Goals -->
                    <div class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500">
                        <h2 class="text-xl font-bold mb-4">📈 Treatment Plan & Goals</h2>
                        <div id="treatment-plan">
                            ${generateTreatmentPlan(assessment)}
                        </div>
                    </div>
                    
                    <!-- Social Diagnosis (ICD-10/11 Z-Codes) -->
                    <div class="bg-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500">
                        <h2 class="text-xl font-bold mb-4">🏥 Social Diagnosis (ICD-10/11 Z-Codes)</h2>
                        <div id="social-diagnosis">
                            ${generateSocialDiagnosis(assessment)}
                        </div>
                    </div>
                    
                    <!-- Clinical Summary -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h2 class="text-xl font-bold mb-4">📊 Clinical Summary</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div><strong>Assessment Date:</strong> ${new Date(assessment.completedDate).toLocaleDateString()}</div>
                                <div><strong>Session Duration:</strong> ${getSessionDuration(assessment)} minutes</div>
                                <div><strong>Assessment Type:</strong> ${assessment.assessmentTitle}</div>
                                <div><strong>Risk Level:</strong> ${getRiskLevel(assessment)}</div>
                            </div>
                            <div class="space-y-3">
                                <div><strong>Clinician:</strong> ${document.getElementById('practitioner-name').value}</div>
                                <div><strong>License:</strong> ${document.getElementById('license-number').value}</div>
                                <div><strong>Next Appointment:</strong> ${getNextAppointment()}</div>
                                <div><strong>Follow-up Required:</strong> ${getFollowupRequirement(assessment)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Professional Documentation -->
                    <div class="bg-yellow-50 p-6 rounded-lg border-l-4 border-yellow-500">
                        <h2 class="text-xl font-bold mb-4">📝 Professional Documentation</h2>
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold mb-2">Clinical Rationale:</h3>
                                <p class="text-sm bg-white p-3 rounded border">${generateClinicalRationale(assessment)}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-2">Evidence-Based Practice:</h3>
                                <p class="text-sm bg-white p-3 rounded border">${generateEvidenceBase(assessment)}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-2">Ethical Considerations:</h3>
                                <p class="text-sm bg-white p-3 rounded border">All interventions provided within scope of practice and professional ethical guidelines. Client consent obtained for all treatment activities. Confidentiality maintained per HIPAA and state regulations.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            reportContent.innerHTML = reportHTML;
            
            // Show report view
            document.getElementById('assessment-interface').classList.add('hidden');
            document.getElementById('report-view').classList.remove('hidden');
        }

        function generateDepressionReport(responses) {
            // Calculate PHQ-9 score
            let phq9Score = 0;
            for (let i = 1; i <= 9; i++) {
                const response = responses[`phq9_${i}`];
                if (response) {
                    const score = parseInt(response.match(/\((\d+)\)/)?.[1] || '0');
                    phq9Score += score;
                }
            }
            
            let severity = 'Minimal';
            if (phq9Score >= 20) severity = 'Severe';
            else if (phq9Score >= 15) severity = 'Moderately Severe';
            else if (phq9Score >= 10) severity = 'Moderate';
            else if (phq9Score >= 5) severity = 'Mild';
            
            return `
                <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                    <h3 class="font-bold text-lg mb-2">PHQ-9 Score: ${phq9Score}/27</h3>
                    <p class="text-lg"><strong>Severity Level:</strong> ${severity} Depression</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold mb-2">Symptom Profile:</h4>
                        <div class="grid md:grid-cols-2 gap-2 text-sm">
                            ${Object.entries(responses).filter(([key]) => key.startsWith('phq9_')).map(([key, value]) => {
                                const questionNum = key.split('_')[1];
                                const questions = {
                                    '1': 'Interest/pleasure',
                                    '2': 'Depressed mood',
                                    '3': 'Sleep problems',
                                    '4': 'Fatigue',
                                    '5': 'Appetite changes',
                                    '6': 'Self-worth issues',
                                    '7': 'Concentration',
                                    '8': 'Psychomotor changes',
                                    '9': 'Suicidal thoughts'
                                };
                                return `<div>• ${questions[questionNum]}: ${value}</div>`;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-2">Functional Impact:</h4>
                        <p class="text-sm">${responses.functional_impact || 'Not assessed'}</p>
                    </div>
                </div>
            `;
        }

        function generateAnxietyReport(responses) {
            // Calculate GAD-7 score
            let gad7Score = 0;
            for (let i = 1; i <= 7; i++) {
                const response = responses[`gad7_${i}`];
                if (response) {
                    const score = parseInt(response.match(/\((\d+)\)/)?.[1] || '0');
                    gad7Score += score;
                }
            }
            
            let severity = 'Minimal';
            if (gad7Score >= 15) severity = 'Severe';
            else if (gad7Score >= 10) severity = 'Moderate';
            else if (gad7Score >= 5) severity = 'Mild';
            
            return `
                <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                    <h3 class="font-bold text-lg mb-2">GAD-7 Score: ${gad7Score}/21</h3>
                    <p class="text-lg"><strong>Severity Level:</strong> ${severity} Anxiety</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold mb-2">Anxiety Triggers:</h4>
                        <p class="text-sm bg-gray-50 p-3 rounded">${responses.anxiety_triggers || 'Not specified'}</p>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-2">Current Coping Strategies:</h4>
                        <p class="text-sm bg-gray-50 p-3 rounded">${responses.coping_strategies || 'Not specified'}</p>
                    </div>
                </div>
            `;
        }

        // Helper functions for clinical documentation
        function generatePsychosocialIssues(assessment) {
            const issues = [];
            const responses = assessment.responses;
            
            // Analyze responses to identify psychosocial issues
            if (assessment.assessmentType === 'psychosocial') {
                if (responses.family_history && responses.family_history.toLowerCase().includes('conflict')) {
                    issues.push('Family relationship dysfunction and interpersonal conflicts');
                }
                if (responses.social_support && responses.social_support.toLowerCase().includes('limited')) {
                    issues.push('Social isolation and inadequate support systems');
                }
                if (responses.employment && (responses.employment.toLowerCase().includes('unemployed') || responses.employment.toLowerCase().includes('stress'))) {
                    issues.push('Employment instability and occupational stressors');
                }
                if (responses.housing === 'Temporary housing' || responses.housing === 'Homeless') {
                    issues.push('Housing instability and residential concerns');
                }
                if (responses.financial === 'Significant stress' || responses.financial === 'Crisis') {
                    issues.push('Financial hardship and economic stressors');
                }
                if (responses.legal && responses.legal.trim()) {
                    issues.push('Legal complications and judicial system involvement');
                }
                if (responses.cultural && responses.cultural.toLowerCase().includes('barrier')) {
                    issues.push('Cultural adaptation challenges and identity conflicts');
                }
            } else if (assessment.assessmentType === 'mental-status') {
                if (responses.mood && (responses.mood === 'Depressed' || responses.mood === 'Anxious')) {
                    issues.push('Mood dysregulation affecting psychosocial functioning');
                }
                if (responses.insight === 'Poor' || responses.insight === 'Absent') {
                    issues.push('Limited insight impacting treatment engagement');
                }
                if (responses.judgment === 'Poor' || responses.judgment === 'Impaired') {
                    issues.push('Impaired judgment affecting daily decision-making');
                }
            } else if (assessment.assessmentType === 'risk-assessment') {
                if (responses.suicidal_ideation && responses.suicidal_ideation !== 'None') {
                    issues.push('Suicidal ideation requiring immediate safety planning');
                }
                if (responses.self_harm && responses.self_harm !== 'None reported') {
                    issues.push('Self-harm behaviors indicating emotional dysregulation');
                }
                if (responses.risk_factors && responses.risk_factors.includes('Social isolation')) {
                    issues.push('Social disconnection increasing vulnerability');
                }
            }
            
            // Add default issues if none identified
            if (issues.length === 0) {
                issues.push('Psychosocial stressors impacting overall functioning and well-being');
                issues.push('Need for enhanced coping strategies and support system development');
            }
            
            return `
                <div class="space-y-3">
                    ${issues.map((issue, index) => `
                        <div class="flex items-start space-x-3">
                            <span class="flex-shrink-0 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-bold">${index + 1}</span>
                            <p class="text-sm">${issue}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateClinicalInterventions(assessment) {
            const interventions = [];
            const responses = assessment.responses;
            
            // Generate interventions based on assessment type and responses
            if (assessment.assessmentType === 'psychosocial') {
                interventions.push({
                    category: 'Individual Counseling',
                    intervention: 'Provided supportive counseling using person-centered approach to address presenting concerns',
                    duration: '50 minutes',
                    outcome: 'Client demonstrated improved emotional regulation and insight'
                });
                
                if (responses.family_history && responses.family_history.toLowerCase().includes('conflict')) {
                    interventions.push({
                        category: 'Family Systems Work',
                        intervention: 'Explored family dynamics and provided psychoeducation on healthy communication patterns',
                        duration: '30 minutes',
                        outcome: 'Client gained understanding of family interaction patterns'
                    });
                }
                
                if (responses.social_support && responses.social_support.toLowerCase().includes('limited')) {
                    interventions.push({
                        category: 'Social Skills Training',
                        intervention: 'Taught social connection strategies and community resource identification',
                        duration: '20 minutes',
                        outcome: 'Client identified 3 potential social support resources'
                    });
                }
                
                interventions.push({
                    category: 'Coping Skills Development',
                    intervention: 'Introduced stress management techniques including deep breathing and grounding exercises',
                    duration: '15 minutes',
                    outcome: 'Client successfully demonstrated learned techniques'
                });
                
            } else if (assessment.assessmentType === 'depression') {
                interventions.push({
                    category: 'Cognitive Behavioral Therapy',
                    intervention: 'Applied CBT techniques to identify and challenge negative thought patterns',
                    duration: '45 minutes',
                    outcome: 'Client identified 2 cognitive distortions and alternative thoughts'
                });
                
                interventions.push({
                    category: 'Behavioral Activation',
                    intervention: 'Developed activity scheduling to increase engagement in pleasurable activities',
                    duration: '20 minutes',
                    outcome: 'Client committed to 3 daily activities for mood improvement'
                });
                
            } else if (assessment.assessmentType === 'anxiety') {
                interventions.push({
                    category: 'Anxiety Management',
                    intervention: 'Taught progressive muscle relaxation and mindfulness techniques',
                    duration: '30 minutes',
                    outcome: 'Client reported decreased anxiety during session practice'
                });
                
                interventions.push({
                    category: 'Exposure Planning',
                    intervention: 'Developed graduated exposure hierarchy for anxiety triggers',
                    duration: '25 minutes',
                    outcome: 'Client agreed to begin with least anxiety-provoking situation'
                });
                
            } else if (assessment.assessmentType === 'risk-assessment') {
                interventions.push({
                    category: 'Safety Planning',
                    intervention: 'Developed comprehensive safety plan with coping strategies and support contacts',
                    duration: '40 minutes',
                    outcome: 'Client verbalized understanding and commitment to safety plan'
                });
                
                interventions.push({
                    category: 'Crisis Intervention',
                    intervention: 'Provided immediate stabilization and risk reduction strategies',
                    duration: '30 minutes',
                    outcome: 'Client demonstrated reduced acute distress and improved safety'
                });
            }
            
            // Add default interventions if none specific
            if (interventions.length === 0) {
                interventions.push({
                    category: 'Psychosocial Assessment',
                    intervention: 'Conducted comprehensive psychosocial evaluation and mental status examination',
                    duration: '60 minutes',
                    outcome: 'Completed thorough assessment of client functioning and needs'
                });
            }
            
            return `
                <div class="space-y-4">
                    ${interventions.map((intervention, index) => `
                        <div class="bg-white p-4 rounded-lg border border-green-200">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-green-800">${intervention.category}</h4>
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">${intervention.duration}</span>
                            </div>
                            <p class="text-sm mb-2"><strong>Intervention:</strong> ${intervention.intervention}</p>
                            <p class="text-sm text-green-700"><strong>Outcome:</strong> ${intervention.outcome}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateCaseManagement(assessment) {
            const activities = [];
            const responses = assessment.responses;
            
            // Generate case management activities based on assessment
            if (assessment.assessmentType === 'psychosocial') {
                if (responses.housing === 'Temporary housing' || responses.housing === 'Homeless') {
                    activities.push({
                        activity: 'Housing Resource Coordination',
                        action: 'Contacted local housing authority and provided client with emergency shelter information',
                        status: 'In Progress',
                        followup: 'Follow up on housing application status in 1 week'
                    });
                }
                
                if (responses.financial === 'Significant stress' || responses.financial === 'Crisis') {
                    activities.push({
                        activity: 'Financial Assistance Referral',
                        action: 'Referred to local food bank and financial assistance programs',
                        status: 'Completed',
                        followup: 'Client to report back on application outcomes'
                    });
                }
                
                if (responses.employment && responses.employment.toLowerCase().includes('unemployed')) {
                    activities.push({
                        activity: 'Employment Services Coordination',
                        action: 'Connected with vocational rehabilitation services and job training programs',
                        status: 'Initiated',
                        followup: 'Appointment scheduled for next week'
                    });
                }
            }
            
            // Add standard case management activities
            activities.push({
                activity: 'Treatment Coordination',
                action: 'Coordinated care with primary care physician and reviewed medication compliance',
                status: 'Ongoing',
                followup: 'Monthly coordination meetings scheduled'
            });
            
            activities.push({
                activity: 'Documentation & Reporting',
                action: 'Completed assessment documentation and updated treatment plan',
                status: 'Completed',
                followup: 'Progress notes to be updated weekly'
            });
            
            if (assessment.assessmentType === 'risk-assessment') {
                activities.push({
                    activity: 'Safety Monitoring',
                    action: 'Established daily check-in protocol and emergency contact procedures',
                    status: 'Active',
                    followup: 'Daily safety checks for next 72 hours'
                });
            }
            
            return `
                <div class="space-y-3">
                    ${activities.map(activity => `
                        <div class="bg-white p-4 rounded-lg border border-purple-200">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-semibold text-purple-800">${activity.activity}</h4>
                                <span class="text-xs px-2 py-1 rounded ${
                                    activity.status === 'Completed' ? 'bg-green-100 text-green-700' :
                                    activity.status === 'In Progress' ? 'bg-yellow-100 text-yellow-700' :
                                    activity.status === 'Active' ? 'bg-blue-100 text-blue-700' :
                                    'bg-gray-100 text-gray-700'
                                }">${activity.status}</span>
                            </div>
                            <p class="text-sm mb-2">${activity.action}</p>
                            <p class="text-xs text-purple-600"><strong>Follow-up:</strong> ${activity.followup}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateTreatmentPlan(assessment) {
            const goals = [];
            const responses = assessment.responses;
            
            // Generate treatment goals based on assessment
            if (assessment.assessmentType === 'depression') {
                goals.push({
                    goal: 'Reduce depressive symptoms and improve mood regulation',
                    objectives: [
                        'Client will identify and challenge 3 negative thought patterns weekly',
                        'Client will engage in 2 pleasurable activities daily',
                        'Client will report improved mood scores on PHQ-9 within 4 weeks'
                    ],
                    interventions: ['CBT', 'Behavioral Activation', 'Mood Monitoring'],
                    timeframe: '8-12 weeks'
                });
                
                goals.push({
                    goal: 'Improve social functioning and support system',
                    objectives: [
                        'Client will initiate social contact with 1 person weekly',
                        'Client will attend 1 social activity per week',
                        'Client will identify 3 reliable support persons'
                    ],
                    interventions: ['Social Skills Training', 'Support System Development'],
                    timeframe: '6-8 weeks'
                });
                
            } else if (assessment.assessmentType === 'anxiety') {
                goals.push({
                    goal: 'Reduce anxiety symptoms and improve coping skills',
                    objectives: [
                        'Client will practice relaxation techniques daily',
                        'Client will report decreased anxiety in trigger situations',
                        'Client will complete graduated exposure exercises'
                    ],
                    interventions: ['Relaxation Training', 'Exposure Therapy', 'Cognitive Restructuring'],
                    timeframe: '10-12 weeks'
                });
                
            } else if (assessment.assessmentType === 'psychosocial') {
                goals.push({
                    goal: 'Stabilize psychosocial functioning and address environmental stressors',
                    objectives: [
                        'Client will secure stable housing within 30 days',
                        'Client will establish regular income source',
                        'Client will develop healthy coping strategies for stress'
                    ],
                    interventions: ['Case Management', 'Resource Coordination', 'Stress Management'],
                    timeframe: '12-16 weeks'
                });
                
                goals.push({
                    goal: 'Improve interpersonal relationships and communication skills',
                    objectives: [
                        'Client will practice assertive communication techniques',
                        'Client will resolve 1 significant relationship conflict',
                        'Client will establish 2 new positive relationships'
                    ],
                    interventions: ['Communication Training', 'Relationship Counseling'],
                    timeframe: '8-10 weeks'
                });
            }
            
            // Add default goal if none specific
            if (goals.length === 0) {
                goals.push({
                    goal: 'Improve overall psychosocial functioning and well-being',
                    objectives: [
                        'Client will demonstrate improved coping skills',
                        'Client will report increased life satisfaction',
                        'Client will maintain stable functioning'
                    ],
                    interventions: ['Supportive Counseling', 'Skill Building', 'Psychoeducation'],
                    timeframe: '8-12 weeks'
                });
            }
            
            return `
                <div class="space-y-4">
                    ${goals.map((goal, index) => `
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-semibold text-blue-800">Goal ${index + 1}: ${goal.goal}</h4>
                                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">${goal.timeframe}</span>
                            </div>
                            
                            <div class="mb-3">
                                <h5 class="font-medium text-sm mb-2">Objectives:</h5>
                                <ul class="text-sm space-y-1">
                                    ${goal.objectives.map(obj => `<li class="flex items-start"><span class="text-blue-500 mr-2">•</span>${obj}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="font-medium text-sm mb-2">Interventions:</h5>
                                <div class="flex flex-wrap gap-1">
                                    ${goal.interventions.map(intervention => `
                                        <span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded border">${intervention}</span>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function getSessionDuration(assessment) {
            // Estimate session duration based on assessment type
            const durations = {
                'mental-status': 45,
                'psychosocial': 60,
                'risk-assessment': 30,
                'depression': 50,
                'anxiety': 45,
                'substance-use': 55,
                'career': 90
            };
            return durations[assessment.assessmentType] || 50;
        }
        
        function getRiskLevel(assessment) {
            if (assessment.assessmentType === 'risk-assessment' && assessment.responses.risk_level) {
                return assessment.responses.risk_level;
            } else if (assessment.assessmentType === 'depression') {
                // Calculate PHQ-9 score to determine risk
                let score = 0;
                for (let i = 1; i <= 9; i++) {
                    const response = assessment.responses[`phq9_${i}`];
                    if (response) {
                        score += parseInt(response.match(/\((\d+)\)/)?.[1] || '0');
                    }
                }
                if (score >= 20) return 'High';
                if (score >= 15) return 'Moderate-High';
                if (score >= 10) return 'Moderate';
                if (score >= 5) return 'Low-Moderate';
                return 'Low';
            }
            return 'Low-Moderate';
        }
        
        function getNextAppointment() {
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            return nextWeek.toLocaleDateString();
        }
        
        function getFollowupRequirement(assessment) {
            if (assessment.assessmentType === 'risk-assessment') {
                return '24-48 hours';
            } else if (assessment.assessmentType === 'depression' || assessment.assessmentType === 'anxiety') {
                return '1 week';
            }
            return '2 weeks';
        }
        
        function generateClinicalRationale(assessment) {
            const rationales = {
                'psychosocial': 'Comprehensive psychosocial assessment was indicated to evaluate environmental stressors, support systems, and psychosocial functioning. Interventions focused on addressing identified barriers to functioning and enhancing coping resources through evidence-based social work practice.',
                'mental-status': 'Mental status examination was conducted to assess cognitive and emotional functioning. Clinical interventions targeted identified areas of impairment using therapeutic modalities appropriate for presenting symptoms and client needs.',
                'depression': 'Depression screening and assessment indicated need for mood-focused interventions. Treatment approach utilized cognitive-behavioral techniques and behavioral activation strategies consistent with evidence-based practice for depressive disorders.',
                'anxiety': 'Anxiety assessment revealed need for anxiety management interventions. Treatment incorporated relaxation training and exposure-based techniques supported by research literature on anxiety disorder treatment.',
                'risk-assessment': 'Risk assessment was clinically indicated due to safety concerns. Interventions focused on immediate safety planning and risk reduction using established protocols for suicide and violence risk management.',
                'substance-use': 'Substance use assessment revealed need for addiction-focused interventions. Treatment approach incorporated motivational interviewing and harm reduction strategies consistent with evidence-based addiction treatment.',
                'career': 'Comprehensive career assessment was conducted to support vocational development and career decision-making. Interventions focused on career exploration and planning using established career development theories.'
            };
            
            return rationales[assessment.assessmentType] || 'Clinical assessment and interventions were provided based on presenting concerns and professional judgment, utilizing evidence-based social work practice methods appropriate for client needs.';
        }
        
        function generateEvidenceBase(assessment) {
            const evidenceBases = {
                'psychosocial': 'Interventions based on ecological systems theory (Bronfenbrenner) and strengths-based practice models. Case management activities follow established social work practice standards and NASW Code of Ethics guidelines.',
                'mental-status': 'Assessment procedures follow standardized mental status examination protocols. Interventions utilize evidence-based therapeutic approaches including cognitive-behavioral therapy and person-centered counseling techniques.',
                'depression': 'Treatment approach based on APA Clinical Practice Guidelines for Depression. CBT and behavioral activation interventions supported by extensive research literature (Beck et al., Butler et al.).',
                'anxiety': 'Interventions based on evidence-based treatments for anxiety disorders including exposure therapy and cognitive restructuring (Barlow, Craske). Relaxation techniques supported by anxiety management research.',
                'risk-assessment': 'Risk assessment procedures follow established protocols (Columbia Suicide Severity Rating Scale principles). Safety planning interventions based on Stanley & Brown safety planning model.',
                'substance-use': 'Assessment and interventions based on SAMHSA guidelines and motivational interviewing principles (Miller & Rollnick). Treatment approach incorporates stages of change model (Prochaska & DiClemente).',
                'career': 'Career assessment based on Holland\'s RIASEC model and Super\'s career development theory. Interventions utilize evidence-based career counseling approaches and vocational psychology principles.'
            };
            
            return evidenceBases[assessment.assessmentType] || 'Interventions based on established social work practice theories and evidence-based treatment approaches. All activities conducted within professional scope of practice and ethical guidelines.';
        }
        
        function generateSocialDiagnosis(assessment) {
            const socialDiagnoses = [];
            const responses = assessment.responses;
            
            // ICD-10/11 Z-Codes for Social Determinants and Psychosocial Factors
            const icdCodes = {
                // Housing and Economic Circumstances
                'Z59.0': 'Homelessness',
                'Z59.1': 'Inadequate housing',
                'Z59.2': 'Discord with neighbors, lodgers and landlord',
                'Z59.3': 'Problems related to living in residential institution',
                'Z59.4': 'Lack of adequate food and safe drinking water',
                'Z59.5': 'Extreme poverty',
                'Z59.6': 'Low income',
                'Z59.7': 'Insufficient social insurance and welfare support',
                'Z59.8': 'Other problems related to housing and economic circumstances',
                
                // Education and Literacy
                'Z55.0': 'Illiteracy and low-level literacy',
                'Z55.1': 'Schooling unavailable and unattainable',
                'Z55.2': 'Failed school examinations',
                'Z55.3': 'Underachievement in school',
                'Z55.4': 'Educational maladjustment and discord with teachers and classmates',
                'Z55.8': 'Other problems related to education and literacy',
                
                // Employment and Unemployment
                'Z56.0': 'Unemployment, unspecified',
                'Z56.1': 'Change of job',
                'Z56.2': 'Threat of job loss',
                'Z56.3': 'Stressful work schedule',
                'Z56.4': 'Discord with boss and workmates',
                'Z56.5': 'Uncongenial work environment',
                'Z56.6': 'Other physical and mental strain related to work',
                'Z56.7': 'Other and unspecified problems related to employment',
                'Z56.8': 'Other problems related to employment and unemployment',
                
                // Social Environment
                'Z60.0': 'Problems of adjustment to life-cycle transitions',
                'Z60.2': 'Problems related to living alone',
                'Z60.3': 'Acculturation difficulty',
                'Z60.4': 'Social exclusion and rejection',
                'Z60.5': 'Target of (perceived) adverse discrimination and persecution',
                'Z60.8': 'Other problems related to social environment',
                
                // Family Circumstances
                'Z63.0': 'Problems in relationship with spouse or partner',
                'Z63.1': 'Problems in relationship with in-laws',
                'Z63.2': 'Inadequate family support',
                'Z63.3': 'Absence of family member',
                'Z63.4': 'Disappearance and death of family member',
                'Z63.5': 'Disruption of family by separation and divorce',
                'Z63.6': 'Dependent relative needing care at home',
                'Z63.7': 'Other stressful life events affecting family and household',
                'Z63.8': 'Other specified problems related to primary support group',
                
                // Psychosocial Circumstances
                'Z65.0': 'Conviction in civil and criminal proceedings without imprisonment',
                'Z65.1': 'Imprisonment and other incarceration',
                'Z65.2': 'Problems related to release from prison',
                'Z65.3': 'Problems related to other legal circumstances',
                'Z65.4': 'Victim of crime and terrorism',
                'Z65.5': 'Exposure to disaster, war and other hostilities',
                'Z65.8': 'Other specified problems related to psychosocial circumstances',
                
                // Lifestyle Factors
                'Z72.0': 'Tobacco use',
                'Z72.1': 'Alcohol use',
                'Z72.2': 'Drug use',
                'Z72.3': 'Lack of physical exercise',
                'Z72.4': 'Inappropriate diet and eating habits',
                'Z72.5': 'High risk sexual behavior',
                'Z72.6': 'Gambling and betting',
                'Z72.8': 'Other problems related to lifestyle'
            };
            
            // Analyze assessment responses to determine applicable Z-codes
            if (assessment.assessmentType === 'psychosocial') {
                // Housing issues
                if (responses.housing === 'Homeless') {
                    socialDiagnoses.push({
                        code: 'Z59.0',
                        description: 'Homelessness',
                        severity: 'High',
                        rationale: 'Client reports current homelessness affecting stability and access to services'
                    });
                } else if (responses.housing === 'Temporary housing') {
                    socialDiagnoses.push({
                        code: 'Z59.1',
                        description: 'Inadequate housing',
                        severity: 'Moderate',
                        rationale: 'Client in temporary housing situation affecting long-term stability'
                    });
                }
                
                // Financial issues
                if (responses.financial === 'Crisis') {
                    socialDiagnoses.push({
                        code: 'Z59.5',
                        description: 'Extreme poverty',
                        severity: 'High',
                        rationale: 'Client reports financial crisis impacting basic needs'
                    });
                } else if (responses.financial === 'Significant stress') {
                    socialDiagnoses.push({
                        code: 'Z59.6',
                        description: 'Low income',
                        severity: 'Moderate',
                        rationale: 'Client experiences significant financial stress affecting functioning'
                    });
                }
                
                // Employment issues
                if (responses.employment && responses.employment.toLowerCase().includes('unemployed')) {
                    socialDiagnoses.push({
                        code: 'Z56.0',
                        description: 'Unemployment, unspecified',
                        severity: 'Moderate',
                        rationale: 'Client reports unemployment affecting financial stability and self-esteem'
                    });
                } else if (responses.employment && responses.employment.toLowerCase().includes('stress')) {
                    socialDiagnoses.push({
                        code: 'Z56.6',
                        description: 'Other physical and mental strain related to work',
                        severity: 'Moderate',
                        rationale: 'Client reports work-related stress impacting mental health'
                    });
                }
                
                // Social support issues
                if (responses.social_support && responses.social_support.toLowerCase().includes('limited')) {
                    socialDiagnoses.push({
                        code: 'Z60.2',
                        description: 'Problems related to living alone',
                        severity: 'Moderate',
                        rationale: 'Client reports limited social support and social isolation'
                    });
                }
                
                // Family issues
                if (responses.family_history && responses.family_history.toLowerCase().includes('conflict')) {
                    socialDiagnoses.push({
                        code: 'Z63.0',
                        description: 'Problems in relationship with spouse or partner',
                        severity: 'Moderate',
                        rationale: 'Client reports family conflicts affecting relationships and functioning'
                    });
                }
                
                // Legal issues
                if (responses.legal && responses.legal.trim()) {
                    socialDiagnoses.push({
                        code: 'Z65.3',
                        description: 'Problems related to other legal circumstances',
                        severity: 'Moderate',
                        rationale: 'Client reports legal issues impacting psychosocial functioning'
                    });
                }
                
                // Cultural issues
                if (responses.cultural && responses.cultural.toLowerCase().includes('barrier')) {
                    socialDiagnoses.push({
                        code: 'Z60.3',
                        description: 'Acculturation difficulty',
                        severity: 'Moderate',
                        rationale: 'Client reports cultural barriers affecting adaptation and integration'
                    });
                }
            }
            
            // Mental health related social factors
            if (assessment.assessmentType === 'depression' || assessment.assessmentType === 'anxiety') {
                socialDiagnoses.push({
                    code: 'Z60.4',
                    description: 'Social exclusion and rejection',
                    severity: 'Moderate',
                    rationale: 'Mental health symptoms contributing to social withdrawal and isolation'
                });
            }
            
            // Risk assessment related social factors
            if (assessment.assessmentType === 'risk-assessment') {
                if (responses.risk_factors && responses.risk_factors.includes('Social isolation')) {
                    socialDiagnoses.push({
                        code: 'Z60.2',
                        description: 'Problems related to living alone',
                        severity: 'High',
                        rationale: 'Social isolation identified as risk factor for self-harm'
                    });
                }
                
                if (responses.risk_factors && responses.risk_factors.includes('Financial stress')) {
                    socialDiagnoses.push({
                        code: 'Z59.6',
                        description: 'Low income',
                        severity: 'Moderate',
                        rationale: 'Financial stress contributing to overall risk profile'
                    });
                }
                
                if (responses.risk_factors && responses.risk_factors.includes('Legal problems')) {
                    socialDiagnoses.push({
                        code: 'Z65.3',
                        description: 'Problems related to other legal circumstances',
                        severity: 'Moderate',
                        rationale: 'Legal problems contributing to psychological distress and risk'
                    });
                }
            }
            
            // Substance use related social factors
            if (assessment.assessmentType === 'substance-use') {
                if (responses.consequences && responses.consequences.includes('Legal problems')) {
                    socialDiagnoses.push({
                        code: 'Z65.0',
                        description: 'Conviction in civil and criminal proceedings without imprisonment',
                        severity: 'Moderate',
                        rationale: 'Substance use resulting in legal consequences'
                    });
                }
                
                if (responses.consequences && responses.consequences.includes('Relationship issues')) {
                    socialDiagnoses.push({
                        code: 'Z63.8',
                        description: 'Other specified problems related to primary support group',
                        severity: 'Moderate',
                        rationale: 'Substance use impacting family and social relationships'
                    });
                }
                
                if (responses.consequences && responses.consequences.includes('Work/school problems')) {
                    socialDiagnoses.push({
                        code: 'Z56.7',
                        description: 'Other and unspecified problems related to employment',
                        severity: 'Moderate',
                        rationale: 'Substance use affecting work performance and attendance'
                    });
                }
            }
            
            // Add default social diagnosis if none identified
            if (socialDiagnoses.length === 0) {
                socialDiagnoses.push({
                    code: 'Z65.8',
                    description: 'Other specified problems related to psychosocial circumstances',
                    severity: 'Mild',
                    rationale: 'General psychosocial stressors affecting overall functioning and well-being'
                });
            }
            
            return `
                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-lg border border-indigo-200">
                        <h3 class="font-bold text-indigo-800 mb-3">📋 Primary Social Diagnoses (ICD-10/11 Z-Codes)</h3>
                        <div class="space-y-3">
                            ${socialDiagnoses.map((diagnosis, index) => `
                                <div class="border-l-4 ${
                                    diagnosis.severity === 'High' ? 'border-red-500 bg-red-50' :
                                    diagnosis.severity === 'Moderate' ? 'border-yellow-500 bg-yellow-50' :
                                    'border-green-500 bg-green-50'
                                } p-3 rounded-r-lg">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-gray-800">
                                                <span class="text-indigo-600">${diagnosis.code}</span> - ${diagnosis.description}
                                            </h4>
                                        </div>
                                        <span class="text-xs px-2 py-1 rounded-full ${
                                            diagnosis.severity === 'High' ? 'bg-red-100 text-red-700' :
                                            diagnosis.severity === 'Moderate' ? 'bg-yellow-100 text-yellow-700' :
                                            'bg-green-100 text-green-700'
                                        }">
                                            ${diagnosis.severity} Priority
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-700">
                                        <strong>Clinical Rationale:</strong> ${diagnosis.rationale}
                                    </p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg border border-indigo-200">
                        <h3 class="font-bold text-indigo-800 mb-3">🎯 Social Diagnosis Treatment Implications</h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <h4 class="font-semibold mb-2">Immediate Interventions Needed:</h4>
                                <ul class="space-y-1 text-gray-700">
                                    ${socialDiagnoses.filter(d => d.severity === 'High').map(d => 
                                        `<li class="flex items-start"><span class="text-red-500 mr-2">•</span>Address ${d.description.toLowerCase()}</li>`
                                    ).join('') || '<li class="text-gray-500">No high-priority social issues identified</li>'}
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2">Long-term Social Work Goals:</h4>
                                <ul class="space-y-1 text-gray-700">
                                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span>Stabilize identified social determinants</li>
                                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span>Enhance social support systems</li>
                                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span>Improve access to community resources</li>
                                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span>Address systemic barriers to functioning</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-100 p-4 rounded-lg">
                        <h4 class="font-semibold text-indigo-800 mb-2">📚 ICD-10/11 Documentation Notes:</h4>
                        <p class="text-sm text-indigo-700">
                            Social diagnoses using ICD-10/11 Z-codes document psychosocial and environmental factors that influence health status and contact with health services. These codes support comprehensive biopsychosocial assessment and justify social work interventions for addressing social determinants of health. All codes assigned based on clinical assessment and professional judgment consistent with ICD-10/11 coding guidelines.
                        </p>
                    </div>
                </div>
            `;
        }

        function generateCareerReport(responses) {
            // Calculate scores for different career areas
            const careerAreas = {
                'Realistic': ['interest_1', 'interest_8', 'interest_14', 'interest_20', 'interest_30'],
                'Investigative': ['interest_2', 'interest_9', 'interest_11', 'interest_12'],
                'Artistic': ['interest_5', 'interest_15', 'interest_19', 'interest_23'],
                'Social': ['interest_3', 'interest_7', 'interest_21', 'interest_28'],
                'Enterprising': ['interest_4', 'interest_10', 'interest_13', 'interest_22'],
                'Conventional': ['interest_6', 'interest_18', 'interest_24', 'interest_27']
            };
            
            const areaScores = {};
            Object.entries(careerAreas).forEach(([area, questions]) => {
                let score = 0;
                questions.forEach(q => {
                    const response = responses[q];
                    if (response) {
                        const scoreMap = {
                            'Strongly Disagree': 1,
                            'Disagree': 2,
                            'Neutral': 3,
                            'Agree': 4,
                            'Strongly Agree': 5
                        };
                        score += scoreMap[response] || 0;
                    }
                });
                areaScores[area] = score;
            });
            
            // Find top 3 career areas
            const sortedAreas = Object.entries(areaScores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);
            
            // Calculate skills summary
            const skillCategories = {
                'Technical Skills': ['skill_1', 'skill_8', 'skill_10', 'skill_30'],
                'Communication Skills': ['skill_3', 'skill_9', 'skill_11', 'skill_17'],
                'Leadership Skills': ['skill_4', 'skill_16', 'skill_25', 'skill_28'],
                'Analytical Skills': ['skill_2', 'skill_7', 'skill_12', 'skill_22']
            };
            
            const skillScores = {};
            Object.entries(skillCategories).forEach(([category, skills]) => {
                let total = 0;
                skills.forEach(skill => {
                    const response = responses[skill];
                    if (response) {
                        const scoreMap = {
                            'Poor': 1,
                            'Below Average': 2,
                            'Average': 3,
                            'Above Average': 4,
                            'Excellent': 5
                        };
                        total += scoreMap[response] || 0;
                    }
                });
                skillScores[category] = Math.round((total / skills.length) * 20); // Convert to percentage
            });
            
            // Top work values
            const valueQuestions = Object.keys(responses).filter(key => key.startsWith('value_'));
            const topValues = valueQuestions
                .map(key => ({
                    question: key,
                    response: responses[key],
                    score: {
                        'Not Important': 1,
                        'Slightly Important': 2,
                        'Moderately Important': 3,
                        'Very Important': 4,
                        'Extremely Important': 5
                    }[responses[key]] || 0
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 5);
            
            // Generate top 5 career recommendations
            const top5Careers = generateTop5CareerRecommendations(areaScores, skillScores, topValues);
            
            return `
                <div class="space-y-6">
                    <!-- Top 5 Career Recommendations -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border-2 border-blue-200">
                        <h3 class="text-2xl font-bold mb-4 text-center">🎯 Top 5 Career Recommendations</h3>
                        <div class="space-y-4">
                            ${top5Careers.map((career, index) => `
                                <div class="bg-white p-4 rounded-lg shadow-md border-l-4 ${
                                    index === 0 ? 'border-gold-500 bg-gradient-to-r from-yellow-50 to-orange-50' :
                                    index === 1 ? 'border-silver-500 bg-gradient-to-r from-gray-50 to-blue-50' :
                                    index === 2 ? 'border-bronze-500 bg-gradient-to-r from-orange-50 to-red-50' :
                                    'border-blue-500'
                                }">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center mb-2">
                                                <span class="text-2xl mr-2">${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '⭐'}</span>
                                                <h4 class="text-xl font-bold text-gray-800">${career.title}</h4>
                                            </div>
                                            <p class="text-gray-600 mb-3">${career.description}</p>
                                            <div class="grid md:grid-cols-2 gap-3 text-sm">
                                                <div>
                                                    <strong>💰 Salary Range:</strong> ${career.salaryRange}
                                                </div>
                                                <div>
                                                    <strong>📈 Job Outlook:</strong> ${career.jobOutlook}
                                                </div>
                                                <div>
                                                    <strong>🎓 Education:</strong> ${career.education}
                                                </div>
                                                <div>
                                                    <strong>⏰ Work Environment:</strong> ${career.workEnvironment}
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <strong>🔑 Key Skills Needed:</strong>
                                                <div class="flex flex-wrap gap-1 mt-1">
                                                    ${career.keySkills.map(skill => `
                                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${skill}</span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ml-4 text-center">
                                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-2">
                                                <span class="text-2xl font-bold text-blue-600">${career.matchScore}%</span>
                                            </div>
                                            <p class="text-xs text-gray-600">Match Score</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-6 p-4 bg-white rounded-lg border border-blue-200">
                            <h4 class="font-bold mb-2">🚀 Next Steps for Career Exploration:</h4>
                            <ul class="text-sm space-y-1">
                                <li>• Research these careers on O*NET (onetonline.org) for detailed information</li>
                                <li>• Connect with professionals in these fields through LinkedIn</li>
                                <li>• Consider informational interviews or job shadowing opportunities</li>
                                <li>• Look into relevant education, training, or certification programs</li>
                                <li>• Explore volunteer opportunities in related fields</li>
                            </ul>
                        </div>
                    </div>
            
            return `
                <div class="space-y-6">
                    <!-- Career Interest Profile -->
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Career Interest Profile (Holland Code)</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            ${sortedAreas.map(([area, score], index) => `
                                <div class="bg-white p-4 rounded-lg border-l-4 ${index === 0 ? 'border-blue-500' : index === 1 ? 'border-green-500' : 'border-yellow-500'}">
                                    <h4 class="font-semibold text-lg">${index + 1}. ${area}</h4>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${(score/25)*100}%"></div>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-1">Score: ${score}/25</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-4 p-4 bg-white rounded-lg">
                            <h4 class="font-semibold mb-2">Career Recommendations Based on Your Profile:</h4>
                            <div class="text-sm space-y-1">
                                ${sortedAreas[0][0] === 'Realistic' ? '<p>• Engineering, Construction, Agriculture, Mechanics</p>' : ''}
                                ${sortedAreas[0][0] === 'Investigative' ? '<p>• Research, Science, Medicine, Technology</p>' : ''}
                                ${sortedAreas[0][0] === 'Artistic' ? '<p>• Design, Writing, Performing Arts, Media</p>' : ''}
                                ${sortedAreas[0][0] === 'Social' ? '<p>• Counseling, Teaching, Healthcare, Social Work</p>' : ''}
                                ${sortedAreas[0][0] === 'Enterprising' ? '<p>• Business, Sales, Management, Law</p>' : ''}
                                ${sortedAreas[0][0] === 'Conventional' ? '<p>• Accounting, Administration, Banking, Data Analysis</p>' : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Skills Assessment -->
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Skills Profile</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            ${Object.entries(skillScores).map(([category, score]) => `
                                <div class="bg-white p-4 rounded-lg">
                                    <h4 class="font-semibold">${category}</h4>
                                    <div class="w-full bg-gray-200 rounded-full h-3 mt-2">
                                        <div class="bg-green-600 h-3 rounded-full" style="width: ${score}%"></div>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-1">${score}% Proficiency</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Work Values -->
                    <div class="bg-purple-50 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Top Work Values</h3>
                        <div class="space-y-3">
                            ${topValues.map((value, index) => {
                                const valueLabels = {
                                    'value_1': 'High Salary',
                                    'value_2': 'Job Security',
                                    'value_3': 'Flexible Hours',
                                    'value_4': 'Advancement Opportunities',
                                    'value_5': 'Work-Life Balance',
                                    'value_6': 'Social Impact',
                                    'value_7': 'Creative Freedom',
                                    'value_8': 'Independence',
                                    'value_9': 'Recognition',
                                    'value_10': 'Variety',
                                    'value_11': 'Teamwork',
                                    'value_12': 'Intellectual Challenge',
                                    'value_13': 'Benefits Package',
                                    'value_14': 'Pleasant Environment',
                                    'value_15': 'Helping Others'
                                };
                                return `
                                    <div class="flex justify-between items-center bg-white p-3 rounded-lg">
                                        <span class="font-medium">${index + 1}. ${valueLabels[value.question] || value.question}</span>
                                        <span class="text-sm px-3 py-1 bg-purple-100 text-purple-800 rounded-full">${value.response}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Career Development Recommendations -->
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Career Development Recommendations</h3>
                        <div class="space-y-3 text-sm">
                            <div class="bg-white p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">🎯 Immediate Actions:</h4>
                                <ul class="space-y-1">
                                    <li>• Research careers in your top interest area: ${sortedAreas[0][0]}</li>
                                    <li>• Network with professionals in recommended fields</li>
                                    <li>• Consider informational interviews or job shadowing</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">📚 Skill Development:</h4>
                                <ul class="space-y-1">
                                    <li>• Focus on strengthening your lowest-scoring skill areas</li>
                                    <li>• Seek training or education in your interest areas</li>
                                    <li>• Consider certification programs relevant to your career goals</li>
                                </ul>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg">
                                <h4 class="font-semibold mb-2">🔍 Further Exploration:</h4>
                                <ul class="space-y-1">
                                    <li>• Take additional career assessments for deeper insights</li>
                                    <li>• Explore volunteer opportunities in areas of interest</li>
                                    <li>• Consider career counseling for personalized guidance</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTop5CareerRecommendations(areaScores, skillScores, topValues) {
            // Comprehensive career database with detailed information
            const careerDatabase = {
                'Realistic': [
                    {
                        title: 'Software Engineer',
                        description: 'Design, develop, and maintain software applications and systems',
                        salaryRange: '$70,000 - $150,000',
                        jobOutlook: 'Excellent (22% growth)',
                        education: 'Bachelor\'s degree in Computer Science',
                        workEnvironment: 'Office/Remote',
                        keySkills: ['Programming', 'Problem Solving', 'Technical Analysis', 'Debugging'],
                        requiredSkills: ['Technical Skills', 'Analytical Skills']
                    },
                    {
                        title: 'Civil Engineer',
                        description: 'Design and oversee construction of infrastructure projects',
                        salaryRange: '$65,000 - $120,000',
                        jobOutlook: 'Good (8% growth)',
                        education: 'Bachelor\'s degree in Civil Engineering',
                        workEnvironment: 'Office/Field work',
                        keySkills: ['Engineering Design', 'Project Management', 'CAD Software', 'Mathematics'],
                        requiredSkills: ['Technical Skills', 'Analytical Skills']
                    },
                    {
                        title: 'Mechanical Technician',
                        description: 'Install, maintain, and repair mechanical equipment',
                        salaryRange: '$45,000 - $75,000',
                        jobOutlook: 'Good (7% growth)',
                        education: 'Associate degree or certification',
                        workEnvironment: 'Manufacturing/Industrial',
                        keySkills: ['Mechanical Repair', 'Troubleshooting', 'Hand Tools', 'Safety Protocols'],
                        requiredSkills: ['Technical Skills']
                    }
                ],
                'Investigative': [
                    {
                        title: 'Data Scientist',
                        description: 'Analyze complex data to help organizations make informed decisions',
                        salaryRange: '$85,000 - $165,000',
                        jobOutlook: 'Excellent (35% growth)',
                        education: 'Master\'s degree in Data Science/Statistics',
                        workEnvironment: 'Office/Remote',
                        keySkills: ['Statistical Analysis', 'Python/R', 'Machine Learning', 'Data Visualization'],
                        requiredSkills: ['Analytical Skills', 'Technical Skills']
                    },
                    {
                        title: 'Research Scientist',
                        description: 'Conduct scientific research to advance knowledge in specific fields',
                        salaryRange: '$75,000 - $140,000',
                        jobOutlook: 'Good (6% growth)',
                        education: 'PhD in relevant field',
                        workEnvironment: 'Laboratory/University',
                        keySkills: ['Research Methods', 'Data Analysis', 'Scientific Writing', 'Critical Thinking'],
                        requiredSkills: ['Analytical Skills']
                    },
                    {
                        title: 'Cybersecurity Analyst',
                        description: 'Protect computer networks and systems from cyber threats',
                        salaryRange: '$80,000 - $140,000',
                        jobOutlook: 'Excellent (33% growth)',
                        education: 'Bachelor\'s degree in Cybersecurity/IT',
                        workEnvironment: 'Office/Remote',
                        keySkills: ['Network Security', 'Threat Analysis', 'Risk Assessment', 'Security Tools'],
                        requiredSkills: ['Technical Skills', 'Analytical Skills']
                    }
                ],
                'Artistic': [
                    {
                        title: 'UX/UI Designer',
                        description: 'Design user interfaces and experiences for digital products',
                        salaryRange: '$65,000 - $120,000',
                        jobOutlook: 'Excellent (13% growth)',
                        education: 'Bachelor\'s degree in Design/HCI',
                        workEnvironment: 'Office/Remote',
                        keySkills: ['Design Software', 'User Research', 'Prototyping', 'Visual Design'],
                        requiredSkills: ['Technical Skills']
                    },
                    {
                        title: 'Marketing Creative Director',
                        description: 'Lead creative teams to develop marketing campaigns and brand strategies',
                        salaryRange: '$75,000 - $150,000',
                        jobOutlook: 'Good (10% growth)',
                        education: 'Bachelor\'s degree in Marketing/Design',
                        workEnvironment: 'Office/Agency',
                        keySkills: ['Creative Strategy', 'Team Leadership', 'Brand Development', 'Campaign Management'],
                        requiredSkills: ['Leadership Skills', 'Communication Skills']
                    },
                    {
                        title: 'Content Creator/Writer',
                        description: 'Create engaging content for various media platforms',
                        salaryRange: '$40,000 - $80,000',
                        jobOutlook: 'Good (9% growth)',
                        education: 'Bachelor\'s degree in Communications/English',
                        workEnvironment: 'Office/Remote/Freelance',
                        keySkills: ['Writing', 'Content Strategy', 'SEO', 'Social Media'],
                        requiredSkills: ['Communication Skills']
                    }
                ],
                'Social': [
                    {
                        title: 'Clinical Psychologist',
                        description: 'Provide therapy and psychological services to individuals and groups',
                        salaryRange: '$70,000 - $130,000',
                        jobOutlook: 'Good (8% growth)',
                        education: 'Doctoral degree in Psychology',
                        workEnvironment: 'Private practice/Hospital/Clinic',
                        keySkills: ['Therapy Techniques', 'Assessment', 'Empathy', 'Active Listening'],
                        requiredSkills: ['Communication Skills']
                    },
                    {
                        title: 'Human Resources Manager',
                        description: 'Oversee recruitment, employee relations, and organizational development',
                        salaryRange: '$65,000 - $125,000',
                        jobOutlook: 'Good (9% growth)',
                        education: 'Bachelor\'s degree in HR/Business',
                        workEnvironment: 'Office',
                        keySkills: ['Employee Relations', 'Recruitment', 'Policy Development', 'Conflict Resolution'],
                        requiredSkills: ['Communication Skills', 'Leadership Skills']
                    },
                    {
                        title: 'Social Worker',
                        description: 'Help individuals and families cope with challenges and access resources',
                        salaryRange: '$45,000 - $75,000',
                        jobOutlook: 'Excellent (12% growth)',
                        education: 'Master\'s degree in Social Work',
                        workEnvironment: 'Community centers/Hospitals/Schools',
                        keySkills: ['Case Management', 'Counseling', 'Advocacy', 'Crisis Intervention'],
                        requiredSkills: ['Communication Skills']
                    }
                ],
                'Enterprising': [
                    {
                        title: 'Business Development Manager',
                        description: 'Identify and develop new business opportunities and partnerships',
                        salaryRange: '$70,000 - $140,000',
                        jobOutlook: 'Good (8% growth)',
                        education: 'Bachelor\'s degree in Business/Marketing',
                        workEnvironment: 'Office/Travel',
                        keySkills: ['Sales Strategy', 'Negotiation', 'Relationship Building', 'Market Analysis'],
                        requiredSkills: ['Leadership Skills', 'Communication Skills']
                    },
                    {
                        title: 'Project Manager',
                        description: 'Plan, execute, and oversee projects from initiation to completion',
                        salaryRange: '$75,000 - $130,000',
                        jobOutlook: 'Excellent (11% growth)',
                        education: 'Bachelor\'s degree + PMP certification',
                        workEnvironment: 'Office/Various industries',
                        keySkills: ['Project Planning', 'Risk Management', 'Team Coordination', 'Budget Management'],
                        requiredSkills: ['Leadership Skills', 'Analytical Skills']
                    },
                    {
                        title: 'Sales Manager',
                        description: 'Lead sales teams and develop strategies to meet revenue targets',
                        salaryRange: '$60,000 - $120,000',
                        jobOutlook: 'Good (7% growth)',
                        education: 'Bachelor\'s degree in Business/Marketing',
                        workEnvironment: 'Office/Field',
                        keySkills: ['Sales Leadership', 'Customer Relations', 'Performance Management', 'Market Strategy'],
                        requiredSkills: ['Leadership Skills', 'Communication Skills']
                    }
                ],
                'Conventional': [
                    {
                        title: 'Financial Analyst',
                        description: 'Analyze financial data to guide investment and business decisions',
                        salaryRange: '$65,000 - $110,000',
                        jobOutlook: 'Good (6% growth)',
                        education: 'Bachelor\'s degree in Finance/Economics',
                        workEnvironment: 'Office',
                        keySkills: ['Financial Modeling', 'Data Analysis', 'Excel', 'Report Writing'],
                        requiredSkills: ['Analytical Skills', 'Technical Skills']
                    },
                    {
                        title: 'Operations Manager',
                        description: 'Oversee daily operations and improve organizational efficiency',
                        salaryRange: '$70,000 - $125,000',
                        jobOutlook: 'Good (8% growth)',
                        education: 'Bachelor\'s degree in Business/Operations',
                        workEnvironment: 'Office/Manufacturing',
                        keySkills: ['Process Improvement', 'Quality Control', 'Team Management', 'Data Analysis'],
                        requiredSkills: ['Leadership Skills', 'Analytical Skills']
                    },
                    {
                        title: 'Database Administrator',
                        description: 'Manage and maintain database systems for organizations',
                        salaryRange: '$75,000 - $125,000',
                        jobOutlook: 'Good (10% growth)',
                        education: 'Bachelor\'s degree in IT/Computer Science',
                        workEnvironment: 'Office/Remote',
                        keySkills: ['Database Management', 'SQL', 'System Administration', 'Data Security'],
                        requiredSkills: ['Technical Skills', 'Analytical Skills']
                    }
                ]
            };
            
            // Calculate career matches based on assessment results
            const careerMatches = [];
            
            Object.entries(areaScores).forEach(([area, score]) => {
                if (careerDatabase[area]) {
                    careerDatabase[area].forEach(career => {
                        let matchScore = (score / 25) * 40; // 40% weight for interest area
                        
                        // Add skill match bonus (30% weight)
                        let skillMatch = 0;
                        career.requiredSkills.forEach(requiredSkill => {
                            if (skillScores[requiredSkill]) {
                                skillMatch += skillScores[requiredSkill];
                            }
                        });
                        matchScore += (skillMatch / (career.requiredSkills.length * 100)) * 30;
                        
                        // Add work values alignment (30% weight)
                        let valueMatch = 0;
                        topValues.slice(0, 3).forEach((value, index) => {
                            valueMatch += (value.score / 5) * (3 - index); // Weight top values more
                        });
                        matchScore += (valueMatch / 15) * 30;
                        
                        careerMatches.push({
                            ...career,
                            matchScore: Math.min(Math.round(matchScore), 99),
                            primaryArea: area
                        });
                    });
                }
            });
            
            // Sort by match score and return top 5
            return careerMatches
                .sort((a, b) => b.matchScore - a.matchScore)
                .slice(0, 5);
        }

        function generateGenericReport(responses) {
            return `
                <div class="space-y-4">
                    ${Object.entries(responses).map(([key, value]) => {
                        if (Array.isArray(value)) {
                            return `
                                <div>
                                    <h4 class="font-semibold mb-2">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}:</h4>
                                    <ul class="text-sm bg-gray-50 p-3 rounded">
                                        ${value.map(item => `<li>• ${item}</li>`).join('')}
                                    </ul>
                                </div>
                            `;
                        } else {
                            return `
                                <div>
                                    <h4 class="font-semibold mb-2">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}:</h4>
                                    <p class="text-sm bg-gray-50 p-3 rounded">${value || 'Not provided'}</p>
                                </div>
                            `;
                        }
                    }).join('')}
                </div>
            `;
        }

        function printReport() {
            window.print();
        }

        function printAssessmentQuestions() {
            // Get the current assessment from the most recent completed assessment
            const lastAssessment = completedAssessments[completedAssessments.length - 1];
            if (!lastAssessment) {
                showNotification('No assessment found to print questions for', 'error');
                return;
            }
            
            const assessmentType = lastAssessment.assessmentType;
            const template = assessmentTemplates[assessmentType];
            
            if (!template) {
                showNotification('Assessment template not found', 'error');
                return;
            }
            
            // Create a new window for printing questions
            const printWindow = window.open('', '_blank');
            const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${template.title} - Assessment Questions</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                            color: #333;
                        }
                        .header { 
                            text-align: center; 
                            border-bottom: 2px solid #333; 
                            padding-bottom: 20px; 
                            margin-bottom: 30px;
                        }
                        .header h1 { 
                            margin: 0; 
                            color: #2563eb;
                            font-size: 24px;
                        }
                        .header p { 
                            margin: 5px 0; 
                            color: #666;
                        }
                        .client-info {
                            background: #f8f9fa;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 30px;
                        }
                        .client-info h3 {
                            margin-top: 0;
                            color: #2563eb;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                        }
                        .info-item {
                            border-bottom: 1px solid #ddd;
                            padding-bottom: 5px;
                        }
                        .question { 
                            margin-bottom: 30px; 
                            page-break-inside: avoid;
                        }
                        .question-number { 
                            font-weight: bold; 
                            color: #2563eb;
                            font-size: 16px;
                        }
                        .question-text { 
                            font-weight: 600; 
                            margin: 10px 0;
                            font-size: 14px;
                        }
                        .answer-space { 
                            border-bottom: 1px solid #ccc; 
                            height: 40px; 
                            margin: 10px 0;
                        }
                        .options { 
                            margin: 10px 0; 
                        }
                        .option { 
                            margin: 8px 0; 
                            display: flex;
                            align-items: center;
                        }
                        .checkbox { 
                            width: 15px; 
                            height: 15px; 
                            border: 1px solid #333; 
                            margin-right: 10px;
                            flex-shrink: 0;
                        }
                        .textarea-space {
                            border: 1px solid #ccc;
                            height: 80px;
                            margin: 10px 0;
                        }
                        .footer {
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #ccc;
                            text-align: center;
                            color: #666;
                            font-size: 12px;
                        }
                        @media print {
                            body { margin: 15px; }
                            .question { page-break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${template.title}</h1>
                        <p>${template.description}</p>
                        <p><strong>Clinician:</strong> ${settings.practitionerName || 'Dr. [Your Name]'} | <strong>License:</strong> ${settings.licenseNumber || 'LCSW-12345'}</p>
                        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="client-info">
                        <h3>Client Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <strong>Client Name:</strong> _________________________________
                            </div>
                            <div class="info-item">
                                <strong>Date of Birth:</strong> _________________________________
                            </div>
                            <div class="info-item">
                                <strong>Client ID:</strong> _________________________________
                            </div>
                            <div class="info-item">
                                <strong>Session Date:</strong> _________________________________
                            </div>
                        </div>
                    </div>
                    
                    <div class="questions">
                        ${template.questions.map((question, index) => {
                            let questionHTML = `
                                <div class="question">
                                    <div class="question-number">Question ${index + 1} of ${template.questions.length}</div>
                                    <div class="question-text">${question.question}</div>
                            `;
                            
                            switch (question.type) {
                                case 'textarea':
                                    questionHTML += `
                                        <div class="textarea-space"></div>
                                        <div class="textarea-space"></div>
                                        ${question.placeholder ? `<p style="font-style: italic; color: #666; font-size: 12px;">Note: ${question.placeholder}</p>` : ''}
                                    `;
                                    break;
                                    
                                case 'text':
                                    questionHTML += `
                                        <div class="answer-space"></div>
                                        ${question.placeholder ? `<p style="font-style: italic; color: #666; font-size: 12px;">Note: ${question.placeholder}</p>` : ''}
                                    `;
                                    break;
                                    
                                case 'select':
                                    questionHTML += `
                                        <div class="options">
                                            <p><strong>Select one option:</strong></p>
                                            ${question.options.map(option => `
                                                <div class="option">
                                                    <div class="checkbox"></div>
                                                    <span>${option}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `;
                                    break;
                                    
                                case 'radio':
                                    questionHTML += `
                                        <div class="options">
                                            <p><strong>Select one option:</strong></p>
                                            ${question.options.map(option => `
                                                <div class="option">
                                                    <div class="checkbox" style="border-radius: 50%;"></div>
                                                    <span>${option}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `;
                                    break;
                                    
                                case 'checkbox':
                                    questionHTML += `
                                        <div class="options">
                                            <p><strong>Select all that apply:</strong></p>
                                            ${question.options.map(option => `
                                                <div class="option">
                                                    <div class="checkbox"></div>
                                                    <span>${option}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `;
                                    break;
                            }
                            
                            questionHTML += '</div>';
                            return questionHTML;
                        }).join('')}
                    </div>
                    
                    <div class="footer">
                        <p>Generated by PSW Assessment Suite | ${new Date().toLocaleDateString()}</p>
                        <p>This assessment form is for professional use only. Please ensure all responses are recorded accurately.</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait for content to load, then print
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
            
            showNotification('Assessment questions opened for printing', 'success');
        }

        function emailReport(assessmentId = null) {
            if (assessmentId) {
                const assessment = completedAssessments.find(a => a.id === assessmentId);
                if (assessment) {
                    sendEmailReport(assessment, false);
                }
            } else {
                // Email current report - this would be for the report currently being viewed
                const settings = JSON.parse(localStorage.getItem('pswSettings') || '{}');
                const email = settings.practitionerEmail || 'your.email@example.com';
                const subject = `Assessment Report - ${new Date().toLocaleDateString()}`;
                const body = `Assessment report generated from PSW Assessment Suite.\n\nPlease see attached report for details.`;
                
                window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                showNotification('Email client opened with report details', 'success');
            }
        }

        function viewReport(assessmentId) {
            const assessment = completedAssessments.find(a => a.id === assessmentId);
            if (assessment) {
                generateReport(assessment);
            }
        }

        function viewAllReports() {
            showNotification('All reports feature coming soon! You will be able to view and manage all completed assessments.', 'info');
        }

        function exitAssessment() {
            if (confirm('Are you sure you want to exit? Any unsaved progress will be lost.')) {
                backToDashboard();
            }
        }

        function backToDashboard() {
            document.getElementById('assessment-interface').classList.add('hidden');
            document.getElementById('report-view').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Reset assessment state
            currentAssessment = null;
            currentQuestionIndex = 0;
            assessmentResponses = {};
        }

        function showSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9697d30810a83a1e',t:'MTc1NDI0NTE3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSW Assessment Suite - Mobile Ready</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); }
        .card-shadow { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* Mobile-optimized animations */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Touch-friendly buttons */
        .touch-button {
            touch-action: manipulation;
        }
        
        /* Prevent zoom on iOS */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            select, textarea, input[type="text"], input[type="password"], 
            input[type="datetime"], input[type="datetime-local"], 
            input[type="date"], input[type="month"], input[type="time"], 
            input[type="week"], input[type="number"], input[type="email"], 
            input[type="url"] {
                font-size: 16px;
            }
        }
        
        /* Custom scrollbar for mobile */
        .mobile-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .mobile-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .mobile-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 2px;
        }
        
        /* Login styles */
        .login-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Mobile-specific adjustments */
        @media (max-width: 640px) {
            .mobile-padding {
                padding: 1rem;
            }
            
            .mobile-text {
                font-size: 0.875rem;
            }
            
            .mobile-grid {
                grid-template-columns: repeat(1, minmax(0, 1fr));
                gap: 1rem;
            }
        }
        
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Mobile-Optimized Login Screen -->
    <div id="login-screen" class="login-container flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md card-shadow">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-xl">PSW</span>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">PSW Assessment Suite</h1>
                <p class="text-gray-600 text-sm md:text-base">HIPAA-Compliant Mental Health Platform</p>
                <div class="flex justify-center mt-4">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs md:text-sm font-medium">🔒 Mobile Ready & Secure</span>
                </div>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👤 Username</label>
                    <input type="text" id="username" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Enter your username">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🔒 Password</label>
                    <div class="relative">
                        <input type="password" id="password" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10"
                               placeholder="Enter your password">
                        <button type="button" onclick="togglePasswordVisibility()" 
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <span id="password-toggle-icon">👁️</span>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" id="remember-me" class="mr-2 text-blue-600">
                        <span class="text-sm text-gray-700">💾 Remember me</span>
                    </label>
                    <button type="button" onclick="showSavedLogins()" class="text-blue-600 hover:text-blue-800 text-sm">
                        📋 Saved Logins
                    </button>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white min-h-[44px] px-4 py-3 rounded-lg font-medium transition-colors touch-button hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                    🔐 Secure Login
                </button>
                
                <div class="mt-4">
                    <button type="button" onclick="showRegistration()" class="w-full bg-green-600 text-white text-sm min-h-[44px] px-4 py-3 rounded-lg font-medium transition-colors touch-button hover:bg-green-700">
                        ➕ Create New Account
                    </button>
                </div>
            </form>

            <!-- Registration Form (Hidden by default) -->
            <form id="registration-form" class="space-y-4 hidden">
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold text-gray-900">Create New Account</h2>
                    <p class="text-sm text-gray-600">Join PSW Assessment Suite</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👤 Full Name</label>
                    <input type="text" id="reg-fullname" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           placeholder="Enter your full name">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">📧 Email</label>
                    <input type="email" id="reg-email" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           placeholder="Enter your email">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👤 Username</label>
                    <input type="text" id="reg-username" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           placeholder="Choose a username">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🔒 Password</label>
                    <div class="relative">
                        <input type="password" id="reg-password" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-green-500 focus:border-green-500 pr-10"
                               placeholder="Create a password">
                        <button type="button" onclick="toggleRegPasswordVisibility()" 
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <span id="reg-password-toggle-icon">👁️</span>
                        </button>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        Password should be at least 6 characters
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🔒 Confirm Password</label>
                    <input type="password" id="reg-confirm-password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           placeholder="Confirm your password">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="reg-terms" required class="mr-2 text-green-600">
                    <label for="reg-terms" class="text-sm text-gray-700">
                        I agree to the Terms of Service and Privacy Policy
                    </label>
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white min-h-[44px] px-4 py-3 rounded-lg font-medium transition-colors touch-button hover:bg-green-700 focus:ring-2 focus:ring-green-500">
                    ✅ Create Account
                </button>
                
                <div class="text-center">
                    <button type="button" onclick="showLogin()" class="text-green-600 hover:text-green-800 text-sm min-h-[44px] px-4 py-3 rounded-lg font-medium transition-colors touch-button">
                        ← Back to Login
                    </button>
                </div>
            </form>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <h3 class="font-semibold text-blue-900 mb-2 text-sm">📱 Mobile Features:</h3>
                <ul class="text-xs text-blue-800 space-y-1">
                    <li>• Touch-optimized interface</li>
                    <li>• Works offline after login</li>
                    <li>• Responsive on all devices</li>
                    <li>• Swipe navigation support</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Mobile-Optimized Main Application -->
    <div id="main-app" class="hidden">
        <!-- Mobile-Friendly Header -->
        <header class="bg-white shadow-sm border-b sticky top-0 z-20">
            <div class="px-4 py-3">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center">
                            <span class="text-white font-bold text-sm">PSW</span>
                        </div>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold text-gray-900">PSW Suite</h1>
                            <p class="text-xs text-gray-600 hidden md:block">HIPAA-Compliant Platform</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <!-- Mobile Menu Button -->
                        <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-600 hover:text-blue-600 rounded-lg">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        
                        <!-- Desktop Controls -->
                        <div class="hidden md:flex items-center space-x-2">
                            <div class="flex items-center text-xs bg-green-50 px-2 py-1 rounded-lg">
                                <div class="w-2 h-2 rounded-full bg-green-500 mr-1 pulse"></div>
                                <span class="text-green-700 font-medium">🔒 Secure</span>
                            </div>
                            <button onclick="showSettings()" class="p-2 text-gray-600 hover:text-blue-600 rounded-lg" title="Settings">
                                ⚙️
                            </button>
                            <button onclick="logout()" class="p-2 text-gray-600 hover:text-red-600 rounded-lg" title="Logout">
                                🚪
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="hidden fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden">
            <div class="fixed right-0 top-0 h-full w-64 bg-white shadow-lg transform transition-transform">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center">
                        <h2 class="font-bold text-gray-900">Menu</h2>
                        <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <div class="text-sm text-gray-600">
                        👤 Welcome, <span id="mobile-user">User</span>
                    </div>
                    <div class="text-sm text-green-700 bg-green-50 p-2 rounded">
                        🔒 HIPAA Secure Session
                    </div>
                    <button onclick="showSettings(); toggleMobileMenu();" class="w-full text-left p-2 text-gray-700 hover:bg-gray-100 rounded">
                        ⚙️ Settings
                    </button>
                    <button onclick="exportAllData(); toggleMobileMenu();" class="w-full text-left p-2 text-gray-700 hover:bg-gray-100 rounded">
                        📊 Export Data
                    </button>
                    <button onclick="logout()" class="w-full text-left p-2 text-red-600 hover:bg-red-50 rounded">
                        🚪 Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="pb-20 md:pb-6">
            <!-- Mobile-Optimized Welcome Section -->
            <div class="gradient-bg mx-4 mt-4 rounded-2xl p-6 text-white fade-in">
                <div class="text-center">
                    <h2 class="text-xl md:text-2xl font-bold mb-2">Mental Health Assessment Suite</h2>
                    <p class="text-sm md:text-base opacity-90 mb-4">Comprehensive, mobile-ready assessments</p>
                    <div class="flex flex-wrap justify-center gap-2">
                        <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-xs font-medium">📱 Mobile Ready</span>
                        <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-xs font-medium">🔒 HIPAA Secure</span>
                        <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-xs font-medium">📊 Auto Reports</span>
                    </div>
                </div>
            </div>

            <!-- Mobile Stats Grid -->
            <div class="px-4 mt-6">
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">📋</div>
                        <p class="text-xs text-gray-600">Today</p>
                        <p class="text-lg font-bold text-blue-600" id="today-count">0</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">✅</div>
                        <p class="text-xs text-gray-600">Total</p>
                        <p class="text-lg font-bold text-green-600" id="total-count">0</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">🎯</div>
                        <p class="text-xs text-gray-600">Plans</p>
                        <p class="text-lg font-bold text-purple-600" id="intervention-count">0</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">🛡️</div>
                        <p class="text-xs text-gray-600">Security</p>
                        <p class="text-sm font-bold text-green-600">Active</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">🔄</div>
                        <p class="text-xs text-gray-600">Sync</p>
                        <p class="text-sm font-bold text-blue-600">Ready</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl card-shadow text-center">
                        <div class="text-2xl mb-1">⏱️</div>
                        <p class="text-xs text-gray-600">Session</p>
                        <p class="text-sm font-bold text-orange-600">Active</p>
                    </div>
                </div>
            </div>

            <!-- Mobile Assessment Categories -->
            <div class="px-4 mt-6">
                <div class="bg-white rounded-2xl p-4 md:p-6 card-shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-gray-900">Assessments</h2>
                        <button onclick="showAssessmentGuide()" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm">
                            📖 Guide
                        </button>
                    </div>
                    
                    <!-- Mobile-Friendly Category Tabs -->
                    <div class="flex overflow-x-auto space-x-1 mb-4 bg-gray-100 p-1 rounded-lg">
                        <button onclick="showCategory('clinical')" id="tab-clinical" class="flex-shrink-0 py-2 px-3 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm">
                            🏥 Clinical
                        </button>
                        <button onclick="showCategory('screening')" id="tab-screening" class="flex-shrink-0 py-2 px-3 rounded-md text-sm font-medium transition-colors text-gray-600">
                            🔍 Screening
                        </button>
                        <button onclick="showCategory('specialized')" id="tab-specialized" class="flex-shrink-0 py-2 px-3 rounded-md text-sm font-medium transition-colors text-gray-600">
                            🎯 Specialized
                        </button>
                        <button onclick="showCategory('psychosocial')" id="tab-psychosocial" class="flex-shrink-0 py-2 px-3 rounded-md text-sm font-medium transition-colors text-gray-600">
                            🤝 Social
                        </button>
                    </div>

                    <!-- Clinical Assessments -->
                    <div id="category-clinical" class="assessment-category">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button onclick="startAssessment('mental-status')" 
                                    class="text-left border-2 border-blue-200 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🧠</div>
                                <h3 class="font-bold text-base mb-2">Mental Status Exam</h3>
                                <p class="text-sm text-gray-600 mb-3">Comprehensive psychiatric evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-blue-600 font-medium bg-blue-100 px-2 py-1 rounded">~20 min</span>
                                    <span class="text-xs text-gray-500">High Priority</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('risk-assessment')" 
                                    class="text-left border-2 border-red-200 rounded-xl p-4 hover:border-red-400 hover:bg-red-50 transition-all touch-button">
                                <div class="text-3xl mb-2">⚠️</div>
                                <h3 class="font-bold text-base mb-2">Risk Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Suicide and safety evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-red-600 font-medium bg-red-100 px-2 py-1 rounded">~15 min</span>
                                    <span class="text-xs text-gray-500">Critical</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('depression')" 
                                    class="text-left border-2 border-blue-200 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all touch-button">
                                <div class="text-3xl mb-2">😔</div>
                                <h3 class="font-bold text-base mb-2">Depression Screen</h3>
                                <p class="text-sm text-gray-600 mb-3">PHQ-9 and mood assessment</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-blue-600 font-medium bg-blue-100 px-2 py-1 rounded">~10 min</span>
                                    <span class="text-xs text-gray-500">Standard</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('anxiety')" 
                                    class="text-left border-2 border-yellow-200 rounded-xl p-4 hover:border-yellow-400 hover:bg-yellow-50 transition-all touch-button">
                                <div class="text-3xl mb-2">😰</div>
                                <h3 class="font-bold text-base mb-2">Anxiety Screen</h3>
                                <p class="text-sm text-gray-600 mb-3">GAD-7 and anxiety evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-yellow-600 font-medium bg-yellow-100 px-2 py-1 rounded">~8 min</span>
                                    <span class="text-xs text-gray-500">Standard</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('trauma-assessment')" 
                                    class="text-left border-2 border-purple-200 rounded-xl p-4 hover:border-purple-400 hover:bg-purple-50 transition-all touch-button">
                                <div class="text-3xl mb-2">💔</div>
                                <h3 class="font-bold text-base mb-2">Trauma Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">PTSD and trauma evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-purple-600 font-medium bg-purple-100 px-2 py-1 rounded">~25 min</span>
                                    <span class="text-xs text-gray-500">Specialized</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('substance-use')" 
                                    class="text-left border-2 border-orange-200 rounded-xl p-4 hover:border-orange-400 hover:bg-orange-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🍷</div>
                                <h3 class="font-bold text-base mb-2">Substance Use</h3>
                                <p class="text-sm text-gray-600 mb-3">AUDIT and addiction evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-orange-600 font-medium bg-orange-100 px-2 py-1 rounded">~20 min</span>
                                    <span class="text-xs text-gray-500">Specialized</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Other categories (hidden by default) -->
                    <div id="category-screening" class="assessment-category hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button onclick="startAssessment('bipolar-screening')" 
                                    class="text-left border-2 border-pink-200 rounded-xl p-4 hover:border-pink-400 hover:bg-pink-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🎭</div>
                                <h3 class="font-bold text-base mb-2">Bipolar Screening</h3>
                                <p class="text-sm text-gray-600 mb-3">MDQ and mood disorder evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-pink-600 font-medium bg-pink-100 px-2 py-1 rounded">~12 min</span>
                                    <span class="text-xs text-gray-500">Specialized</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('adhd-screening')" 
                                    class="text-left border-2 border-teal-200 rounded-xl p-4 hover:border-teal-400 hover:bg-teal-50 transition-all touch-button">
                                <div class="text-3xl mb-2">⚡</div>
                                <h3 class="font-bold text-base mb-2">ADHD Screening</h3>
                                <p class="text-sm text-gray-600 mb-3">ASRS and attention evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-teal-600 font-medium bg-teal-100 px-2 py-1 rounded">~15 min</span>
                                    <span class="text-xs text-gray-500">Specialized</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('eating-disorder')" 
                                    class="text-left border-2 border-red-200 rounded-xl p-4 hover:border-red-400 hover:bg-red-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🍽️</div>
                                <h3 class="font-bold text-base mb-2">Eating Disorder</h3>
                                <p class="text-sm text-gray-600 mb-3">EAT-26 and eating behavior</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-red-600 font-medium bg-red-100 px-2 py-1 rounded">~10 min</span>
                                    <span class="text-xs text-gray-500">Specialized</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div id="category-specialized" class="assessment-category hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button onclick="startAssessment('personality-assessment')" 
                                    class="text-left border-2 border-indigo-200 rounded-xl p-4 hover:border-indigo-400 hover:bg-indigo-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🎭</div>
                                <h3 class="font-bold text-base mb-2">Personality Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Big Five and personality evaluation</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-indigo-600 font-medium bg-indigo-100 px-2 py-1 rounded">~35 min</span>
                                    <span class="text-xs text-gray-500">Comprehensive</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('career-assessment')" 
                                    class="text-left border-2 border-blue-200 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all touch-button">
                                <div class="text-3xl mb-2">💼</div>
                                <h3 class="font-bold text-base mb-2">Career Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Holland Code and career interests</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-blue-600 font-medium bg-blue-100 px-2 py-1 rounded">~30 min</span>
                                    <span class="text-xs text-gray-500">Comprehensive</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('stress-assessment')" 
                                    class="text-left border-2 border-orange-200 rounded-xl p-4 hover:border-orange-400 hover:bg-orange-50 transition-all touch-button">
                                <div class="text-3xl mb-2">😤</div>
                                <h3 class="font-bold text-base mb-2">Stress Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">PSS and stress management</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-orange-600 font-medium bg-orange-100 px-2 py-1 rounded">~15 min</span>
                                    <span class="text-xs text-gray-500">Standard</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div id="category-psychosocial" class="assessment-category hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button onclick="startAssessment('psychosocial')" 
                                    class="text-left border-2 border-green-200 rounded-xl p-4 hover:border-green-400 hover:bg-green-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🤝</div>
                                <h3 class="font-bold text-base mb-2">Psychosocial Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Social history and support systems</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-green-600 font-medium bg-green-100 px-2 py-1 rounded">~25 min</span>
                                    <span class="text-xs text-gray-500">Comprehensive</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('cultural-assessment')" 
                                    class="text-left border-2 border-purple-200 rounded-xl p-4 hover:border-purple-400 hover:bg-purple-50 transition-all touch-button">
                                <div class="text-3xl mb-2">🌍</div>
                                <h3 class="font-bold text-base mb-2">Cultural Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Cultural background and beliefs</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-purple-600 font-medium bg-purple-100 px-2 py-1 rounded">~15 min</span>
                                    <span class="text-xs text-gray-500">Important</span>
                                </div>
                            </button>

                            <button onclick="startAssessment('financial-assessment')" 
                                    class="text-left border-2 border-green-200 rounded-xl p-4 hover:border-green-400 hover:bg-green-50 transition-all touch-button">
                                <div class="text-3xl mb-2">💰</div>
                                <h3 class="font-bold text-base mb-2">Financial Assessment</h3>
                                <p class="text-sm text-gray-600 mb-3">Financial stress and resources</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-green-600 font-medium bg-green-100 px-2 py-1 rounded">~10 min</span>
                                    <span class="text-xs text-gray-500">Practical</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Recent Assessments -->
            <div class="px-4 mt-6">
                <div class="bg-white rounded-2xl p-4 md:p-6 card-shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-gray-900">Recent Assessments</h2>
                        <div class="flex space-x-2">
                            <button onclick="exportAllData()" class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-lg touch-button">
                                📊 Export
                            </button>
                            <button onclick="clearAllData()" class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-lg touch-button">
                                🗑️ Clear
                            </button>
                        </div>
                    </div>
                    <div id="recent-assessments" class="mobile-scroll max-h-64 overflow-y-auto">
                        <p class="text-gray-600 text-center py-8 text-sm">No assessments completed yet. Start your first assessment above!</p>
                    </div>
                </div>
            </div>

            <!-- Mobile Quick Actions -->
            <div class="px-4 mt-6 mb-6">
                <div class="bg-white rounded-2xl p-4 md:p-6 card-shadow">
                    <h2 class="text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mb-4">Quick Actions</h2>
                    <div class="space-y-3">
                        <button onclick="generateInterventionPlan()" class="w-full text-left p-3 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 touch-button">
                            <div class="flex items-center">
                                <div class="text-xl mr-3">🎯</div>
                                <div>
                                    <h3 class="font-semibold text-purple-900 text-sm">Generate Intervention Plan</h3>
                                    <p class="text-xs text-purple-700">Create evidence-based treatment plans</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="createSocialDiagnosis()" class="w-full text-left p-3 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 touch-button">
                            <div class="flex items-center">
                                <div class="text-xl mr-3">🏥</div>
                                <div>
                                    <h3 class="font-semibold text-blue-900 text-sm">Social Diagnosis Tool</h3>
                                    <p class="text-xs text-blue-700">Generate DSM-5 compatible diagnoses</p>
                                </div>
                            </div>
                        </button>

                        <button onclick="showCrisisResources()" class="w-full text-left p-3 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 touch-button">
                            <div class="flex items-center">
                                <div class="text-xl mr-3">🚨</div>
                                <div>
                                    <h3 class="font-semibold text-red-900 text-sm">Crisis Resources</h3>
                                    <p class="text-xs text-red-700">Emergency contacts and crisis tools</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-2 z-30 md:hidden">
            <div class="flex justify-around">
                <button onclick="scrollToTop()" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                    </svg>
                    <span class="text-xs mt-1">Top</span>
                </button>
                <button onclick="showSettings()" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="text-xs mt-1">Settings</span>
                </button>
                <button onclick="exportAllData()" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span class="text-xs mt-1">Export</span>
                </button>
                <button onclick="showCrisisResources()" class="flex flex-col items-center p-2 text-gray-600 hover:text-red-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <span class="text-xs mt-1">Crisis</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile-Optimized Assessment Interface -->
    <div id="assessment-screen" class="hidden fixed inset-0 bg-white z-40 overflow-y-auto">
        <div class="min-h-screen">
            <!-- Mobile Assessment Header -->
            <div class="bg-white border-b p-4 sticky top-0 z-10">
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-900" id="assessment-title">Assessment</h1>
                        <p class="text-sm text-gray-600" id="assessment-description">Assessment description</p>
                    </div>
                    <button onclick="exitAssessment()" class="text-gray-500 hover:text-red-600 text-2xl p-2">
                        ✕
                    </button>
                </div>
                
                <!-- Mobile Progress Bar -->
                <div class="mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Progress</span>
                        <span class="text-sm text-gray-600" id="progress-percentage">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                        <span>Question <span id="current-question">1</span> of <span id="total-questions">10</span></span>
                        <span id="estimated-time">Est. 15 min</span>
                    </div>
                </div>
            </div>

            <!-- Mobile Client Information -->
            <div class="p-4">
                <div class="bg-white rounded-xl p-4 card-shadow mb-4">
                    <h2 class="text-lg font-bold mb-3 text-gray-900">Client Information</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Client Name *</label>
                            <input type="text" id="client-name" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                                <input type="date" id="client-dob" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Session Date *</label>
                                <input type="date" id="session-date" required 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                            <select id="client-gender" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select...</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Non-binary">Non-binary</option>
                                <option value="Other">Other</option>
                                <option value="Prefer not to say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Mobile Question Container -->
                <div class="bg-white rounded-xl p-4 card-shadow mb-4">
                    <div id="question-container">
                        <!-- Questions will be loaded here -->
                    </div>
                </div>

                <!-- Mobile Navigation -->
                <div class="flex justify-between items-center mb-20">
                    <button id="prev-btn" onclick="previousQuestion()" 
                            class="px-4 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 touch-button disabled:opacity-50" 
                            disabled>
                        ← Previous
                    </button>
                    
                    <div class="flex space-x-2">
                        <button onclick="saveProgress()" class="px-3 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 touch-button text-sm">
                            💾 Save
                        </button>
                        <button onclick="skipQuestion()" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 touch-button text-sm">
                            ⏭️ Skip
                        </button>
                    </div>
                    
                    <button id="next-btn" onclick="nextQuestion()" 
                            class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 touch-button">
                        Next →
                    </button>
                    <button id="complete-btn" onclick="completeAssessment()" 
                            class="hidden px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 touch-button">
                        Complete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile-Optimized Report View -->
    <div id="report-screen" class="hidden fixed inset-0 bg-white z-40 overflow-y-auto">
        <div class="min-h-screen">
            <div class="p-4">
                <!-- Mobile Report Header -->
                <div class="border-b pb-4 mb-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold text-gray-900 mb-2">Assessment Report</h1>
                            <p class="text-sm text-gray-600">Generated on <span id="report-date"></span></p>
                        </div>
                        <button onclick="backToDashboard()" class="text-gray-500 hover:text-gray-700 text-2xl p-2">
                            ✕
                        </button>
                    </div>
                    
                    <!-- Mobile Action Buttons -->
                    <div class="flex flex-wrap gap-2 mt-4">
                        <button onclick="downloadReport()" class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 touch-button text-sm">
                            📥 Download
                        </button>
                        <button onclick="emailReport()" class="px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 touch-button text-sm">
                            📧 Email
                        </button>
                        <button onclick="printReport()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 touch-button text-sm">
                            🖨️ Print
                        </button>
                    </div>
                </div>

                <!-- Mobile Report Content -->
                <div id="report-content" class="space-y-6">
                    <!-- Report content will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6 card-shadow">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-900">⚙️ Settings</h2>
                <button onclick="closeSettings()" class="text-gray-400 hover:text-gray-600 text-2xl">×</button>
            </div>
            
            <div class="space-y-4">
                <!-- Mobile Practitioner Info -->
                <div class="bg-gray-50 p-4 rounded-xl">
                    <h3 class="text-base font-bold mb-3">👨‍⚕️ Practitioner Info</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input type="text" id="practitioner-name" value="Dr. [Your Name]" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">License Number</label>
                            <input type="text" id="license-number" value="LCSW-12345" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="practitioner-email" value="your.email@example.com" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base">
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Security Settings -->
                <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                    <h3 class="text-base font-bold mb-3">🔒 Security Settings</h3>
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="auto-logout" class="mr-3 text-green-600" checked>
                            <span class="text-sm">⏱️ Auto-logout after 30 minutes</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="secure-delete" class="mr-3 text-green-600" checked>
                            <span class="text-sm">🗑️ Secure delete with overwriting</span>
                        </label>
                        <div class="text-xs text-green-700 bg-green-100 p-2 rounded">
                            <strong>🔒 HIPAA Status:</strong> ACTIVE<br>
                            <strong>🛡️ Encryption:</strong> AES-256 Style<br>
                            <strong>📱 Mobile Ready:</strong> Optimized
                        </div>
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 touch-button font-medium">
                    💾 Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Notification Container -->
    <div id="notifications" class="fixed top-4 left-4 right-4 z-50 space-y-2"></div>

    <!-- Mobile Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 text-center max-w-sm w-full">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-base font-medium text-gray-900">Processing...</p>
            <p class="text-sm text-gray-600" id="loading-message">Please wait</p>
        </div>
    </div>

    <script>
        // Enhanced Mobile-First Global Variables
        let currentUser = null;
        let currentAssessment = null;
        let currentQuestionIndex = 0;
        let assessmentResponses = {};
        let completedAssessments = [];
        let sessionTimeout = null;
        let sessionStartTime = Date.now();
        let encryptionKey = null;
        let isMobile = window.innerWidth <= 768;

        // User management

        // User registration and login management
        function getStoredUsers() {
            try {
                const users = localStorage.getItem('pswRegisteredUsers');
                return users ? JSON.parse(users) : {};
            } catch (error) {
                return {};
            }
        }

        function saveUser(username, password, email, fullName) {
            const users = getStoredUsers();
            users[username] = {
                password: password,
                email: email,
                fullName: fullName,
                registeredDate: new Date().toISOString(),
                lastLogin: null
            };
            localStorage.setItem('pswRegisteredUsers', JSON.stringify(users));
        }

        function validateUser(username, password) {
            const users = getStoredUsers();
            
            // Check registered users
            if (users[username] && users[username].password === password) {
                // Update last login
                users[username].lastLogin = new Date().toISOString();
                localStorage.setItem('pswRegisteredUsers', JSON.stringify(users));
                
                return { 
                    valid: true, 
                    user: { 
                        username: username, 
                        fullName: users[username].fullName,
                        email: users[username].email 
                    } 
                };
            }
            
            return { valid: false, user: null };
        }

        // Mobile-optimized assessment templates
        const assessmentTemplates = {
            'mental-status': {
                title: 'Mental Status Examination',
                description: 'Comprehensive psychiatric evaluation including mood, cognition, and thought processes',
                category: 'clinical',
                estimatedTime: 20,
                questions: [
                    {
                        id: 'appearance',
                        type: 'radio',
                        question: 'How would you describe the client\'s general appearance?',
                        options: ['Well-groomed', 'Somewhat disheveled', 'Poorly groomed', 'Bizarre appearance', 'Unable to assess'],
                        category: 'Appearance',
                        required: true
                    },
                    {
                        id: 'mood',
                        type: 'radio',
                        question: 'What is the client\'s predominant mood?',
                        options: ['Euthymic (normal)', 'Depressed', 'Anxious', 'Irritable', 'Euphoric', 'Labile (changeable)'],
                        category: 'Mood',
                        required: true
                    },
                    {
                        id: 'affect',
                        type: 'radio',
                        question: 'How would you describe the client\'s affect (emotional expression)?',
                        options: ['Appropriate', 'Flat/Blunted', 'Restricted', 'Labile', 'Inappropriate'],
                        category: 'Affect',
                        required: true
                    },
                    {
                        id: 'speech',
                        type: 'radio',
                        question: 'Describe the client\'s speech pattern:',
                        options: ['Normal rate and volume', 'Rapid/Pressured', 'Slow/Soft', 'Loud/Aggressive', 'Incoherent'],
                        category: 'Speech',
                        required: true
                    },
                    {
                        id: 'thought_process',
                        type: 'radio',
                        question: 'How organized is the client\'s thought process?',
                        options: ['Logical and organized', 'Circumstantial', 'Tangential', 'Flight of ideas', 'Disorganized'],
                        category: 'Thought Process',
                        required: true
                    },
                    {
                        id: 'thought_content',
                        type: 'checkbox',
                        question: 'Check any concerning thought content present:',
                        options: ['Delusions', 'Obsessions', 'Compulsions', 'Phobias', 'Suicidal ideation', 'Homicidal ideation', 'None noted'],
                        category: 'Thought Content',
                        required: true
                    },
                    {
                        id: 'perceptions',
                        type: 'checkbox',
                        question: 'Check any perceptual disturbances:',
                        options: ['Auditory hallucinations', 'Visual hallucinations', 'Tactile hallucinations', 'Olfactory hallucinations', 'None reported'],
                        category: 'Perceptions',
                        required: true
                    },
                    {
                        id: 'orientation',
                        type: 'checkbox',
                        question: 'Client is oriented to:',
                        options: ['Person', 'Place', 'Time', 'Situation'],
                        category: 'Orientation',
                        required: true
                    },
                    {
                        id: 'memory',
                        type: 'radio',
                        question: 'How is the client\'s memory functioning?',
                        options: ['Intact', 'Mild impairment', 'Moderate impairment', 'Severe impairment', 'Unable to assess'],
                        category: 'Memory',
                        required: true
                    },
                    {
                        id: 'insight',
                        type: 'radio',
                        question: 'What level of insight does the client demonstrate?',
                        options: ['Good insight', 'Fair insight', 'Poor insight', 'No insight', 'Unable to assess'],
                        category: 'Insight',
                        required: true
                    }
                ]
            },
            'depression': {
                title: 'Depression Screening (PHQ-9)',
                description: 'Patient Health Questionnaire for depression assessment',
                category: 'screening',
                estimatedTime: 10,
                questions: [
                    {
                        id: 'phq9_1',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by little interest or pleasure in doing things?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_2',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by feeling down, depressed, or hopeless?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_3',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by trouble falling or staying asleep, or sleeping too much?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_4',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by feeling tired or having little energy?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_5',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by poor appetite or overeating?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_6',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by feeling bad about yourself or that you are a failure or have let yourself or your family down?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_7',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by trouble concentrating on things, such as reading the newspaper or watching television?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_8',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by moving or speaking so slowly that other people could have noticed? Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    },
                    {
                        id: 'phq9_9',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by thoughts that you would be better off dead, or of hurting yourself?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'PHQ-9',
                        required: true
                    }
                ]
            },
            'anxiety': {
                title: 'Anxiety Screening (GAD-7)',
                description: 'Generalized Anxiety Disorder assessment',
                category: 'screening',
                estimatedTime: 8,
                questions: [
                    {
                        id: 'gad7_1',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by feeling nervous, anxious, or on edge?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_2',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by not being able to stop or control worrying?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_3',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by worrying too much about different things?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_4',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by trouble relaxing?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_5',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by being so restless that it is hard to sit still?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_6',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by becoming easily annoyed or irritable?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    },
                    {
                        id: 'gad7_7',
                        type: 'radio',
                        question: 'Over the last 2 weeks, how often have you been bothered by feeling afraid, as if something awful might happen?',
                        options: ['Not at all', 'Several days', 'More than half the days', 'Nearly every day'],
                        category: 'GAD-7',
                        required: true
                    }
                ]
            },
            'risk-assessment': {
                title: 'Comprehensive Risk Assessment',
                description: 'Suicide, self-harm, and safety evaluation with crisis intervention planning',
                category: 'clinical',
                estimatedTime: 15,
                questions: [
                    {
                        id: 'suicidal_ideation',
                        type: 'radio',
                        question: 'Are you currently having thoughts of suicide or self-harm?',
                        options: ['No thoughts', 'Passive thoughts (wish to be dead)', 'Active thoughts without plan', 'Active thoughts with plan', 'Active thoughts with plan and intent'],
                        category: 'Suicidal Risk',
                        required: true
                    },
                    {
                        id: 'suicide_plan',
                        type: 'textarea',
                        question: 'If yes to suicidal thoughts, please describe any plan or method considered:',
                        category: 'Suicidal Risk',
                        required: false
                    },
                    {
                        id: 'suicide_history',
                        type: 'radio',
                        question: 'Have you ever attempted suicide in the past?',
                        options: ['Never', 'Once, more than 5 years ago', 'Once, within 5 years', 'Multiple times, more than 5 years ago', 'Multiple times, within 5 years', 'Recent attempt (within 1 year)'],
                        category: 'Suicidal Risk',
                        required: true
                    },
                    {
                        id: 'protective_factors',
                        type: 'checkbox',
                        question: 'What protective factors are present?',
                        options: ['Strong family support', 'Religious/spiritual beliefs', 'Responsibility for children/pets', 'Future goals/plans', 'Fear of death/pain', 'Treatment engagement', 'Stable housing', 'Employment'],
                        category: 'Protective Factors',
                        required: true
                    },
                    {
                        id: 'risk_factors',
                        type: 'checkbox',
                        question: 'What risk factors are present?',
                        options: ['Recent loss/trauma', 'Substance use', 'Social isolation', 'Chronic illness', 'Financial problems', 'Legal problems', 'Relationship problems', 'Mental illness'],
                        category: 'Risk Factors',
                        required: true
                    },
                    {
                        id: 'homicidal_ideation',
                        type: 'radio',
                        question: 'Are you having thoughts of harming others?',
                        options: ['No thoughts', 'General anger/frustration', 'Specific thoughts without plan', 'Specific thoughts with plan', 'Imminent threat'],
                        category: 'Violence Risk',
                        required: true
                    },
                    {
                        id: 'safety_plan',
                        type: 'radio',
                        question: 'Is the client willing to develop a safety plan?',
                        options: ['Yes, fully cooperative', 'Yes, with some reluctance', 'Uncertain/ambivalent', 'No, refuses', 'Unable to assess'],
                        category: 'Safety Planning',
                        required: true
                    },
                    {
                        id: 'immediate_safety',
                        type: 'radio',
                        question: 'What is your assessment of immediate safety?',
                        options: ['Low risk - safe for discharge', 'Moderate risk - safety plan needed', 'High risk - close monitoring required', 'Imminent risk - immediate intervention needed'],
                        category: 'Safety Assessment',
                        required: true
                    }
                ]
            }
        };

        // Mobile-optimized encryption functions
        function generateEncryptionKey() {
            if (!encryptionKey) {
                encryptionKey = 'PSW-MOBILE-' + Date.now() + '-' + Math.random().toString(36).substr(2, 16);
            }
            return encryptionKey;
        }

        function mobileEncrypt(text) {
            const key = generateEncryptionKey();
            let encrypted = '';
            for (let i = 0; i < text.length; i++) {
                const keyChar = key.charCodeAt(i % key.length);
                const textChar = text.charCodeAt(i);
                encrypted += String.fromCharCode((textChar + keyChar) % 65536);
            }
            return btoa(encrypted);
        }

        function mobileDecrypt(encryptedText) {
            const key = generateEncryptionKey();
            const encrypted = atob(encryptedText);
            let decrypted = '';
            for (let i = 0; i < encrypted.length; i++) {
                const keyChar = key.charCodeAt(i % key.length);
                const encryptedChar = encrypted.charCodeAt(i);
                decrypted += String.fromCharCode((encryptedChar - keyChar + 65536) % 65536);
            }
            return decrypted;
        }

        // Mobile data management
        function mobileLoadData() {
            try {
                const encryptedData = localStorage.getItem('pswMobileAssessments');
                if (encryptedData) {
                    const decryptedData = mobileDecrypt(encryptedData);
                    completedAssessments = JSON.parse(decryptedData);
                } else {
                    completedAssessments = [];
                }
            } catch (error) {
                console.warn('Could not decrypt mobile data, starting fresh');
                completedAssessments = [];
            }
        }

        function mobileSaveData() {
            try {
                const dataToEncrypt = JSON.stringify(completedAssessments);
                const encryptedData = mobileEncrypt(dataToEncrypt);
                localStorage.setItem('pswMobileAssessments', encryptedData);
                showNotification('🔒 Data encrypted and saved securely', 'success');
            } catch (error) {
                showNotification('❌ Error saving encrypted data', 'error');
            }
        }

        // Mobile-optimized login system

        function showRegistration() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('registration-form').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registration-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('password-toggle-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = '👁️';
            }
        }

        function toggleRegPasswordVisibility() {
            const passwordInput = document.getElementById('reg-password');
            const toggleIcon = document.getElementById('reg-password-toggle-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = '👁️';
            }
        }

        function saveToQuickLogin(username, fullName) {
            try {
                const quickLogins = JSON.parse(localStorage.getItem('pswQuickLogins') || '[]');
                
                // Remove existing entry for this username
                const filtered = quickLogins.filter(login => login.username !== username);
                
                // Add new entry at the beginning
                filtered.unshift({
                    username: username,
                    fullName: fullName,
                    lastUsed: new Date().toISOString()
                });
                
                // Keep only last 5 logins
                const limited = filtered.slice(0, 5);
                
                localStorage.setItem('pswQuickLogins', JSON.stringify(limited));
            } catch (error) {
                console.warn('Could not save quick login');
            }
        }

        function showSavedLogins() {
            try {
                const quickLogins = JSON.parse(localStorage.getItem('pswQuickLogins') || '[]');
                
                if (quickLogins.length === 0) {
                    showNotification('No saved logins found. Enable "Remember me" to save logins.', 'info');
                    return;
                }
                
                let loginHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-gray-900">📋 Saved Logins</h2>
                                <button onclick="closeSavedLogins()" class="text-gray-400 hover:text-gray-600 text-2xl">×</button>
                            </div>
                            
                            <div class="space-y-3">
                `;
                
                quickLogins.forEach(login => {
                    const lastUsed = new Date(login.lastUsed).toLocaleDateString();
                    loginHTML += `
                        <button onclick="useQuickLogin('${login.username}')" 
                                class="w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-gray-900">${login.fullName}</div>
                                    <div class="text-sm text-gray-600">@${login.username}</div>
                                </div>
                                <div class="text-xs text-gray-500">
                                    ${lastUsed}
                                </div>
                            </div>
                        </button>
                    `;
                });
                
                loginHTML += `
                            </div>
                            
                            <div class="mt-4 pt-4 border-t">
                                <button onclick="clearSavedLogins()" class="w-full text-red-600 hover:text-red-800 text-sm py-2">
                                    🗑️ Clear All Saved Logins
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', loginHTML);
                
            } catch (error) {
                showNotification('Error loading saved logins', 'error');
            }
        }

        function closeSavedLogins() {
            const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (modal) {
                modal.remove();
            }
        }

        function useQuickLogin(username) {
            try {
                const sessionData = JSON.parse(localStorage.getItem('pswMobileSession') || '{}');
                
                if (sessionData.username === username && sessionData.expires > Date.now()) {
                    // Use saved session
                    document.getElementById('username').value = sessionData.username;
                    document.getElementById('password').value = sessionData.password;
                    document.getElementById('remember-me').checked = true;
                    
                    closeSavedLogins();
                    showNotification('🔐 Login credentials loaded from saved session', 'success');
                } else {
                    // Just fill username
                    document.getElementById('username').value = username;
                    document.getElementById('password').focus();
                    
                    closeSavedLogins();
                    showNotification('👤 Username loaded. Please enter your password.', 'info');
                }
            } catch (error) {
                document.getElementById('username').value = username;
                document.getElementById('password').focus();
                closeSavedLogins();
                showNotification('👤 Username loaded. Please enter your password.', 'info');
            }
        }

        function clearSavedLogins() {
            if (confirm('Are you sure you want to clear all saved logins?')) {
                localStorage.removeItem('pswQuickLogins');
                localStorage.removeItem('pswMobileSession');
                closeSavedLogins();
                showNotification('🗑️ All saved logins cleared', 'success');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            if (!username || !password) {
                showNotification('Please enter both username and password', 'error');
                return;
            }
            
            const validation = validateUser(username, password);
            
            if (validation.valid) {
                currentUser = validation.user;
                
                // Save login credentials if remember me is checked
                if (rememberMe) {
                    const sessionData = {
                        username: username,
                        password: password, // In real app, use secure token
                        fullName: validation.user.fullName,
                        email: validation.user.email,
                        expires: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30 days
                    };
                    localStorage.setItem('pswMobileSession', JSON.stringify(sessionData));
                    
                    // Also save to quick login list
                    saveToQuickLogin(username, validation.user.fullName);
                }
                
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('current-user').textContent = validation.user.fullName || username;
                document.getElementById('mobile-user').textContent = validation.user.fullName || username;
                
                initializeMobileApp();
                showNotification(`🔐 Welcome back, ${validation.user.fullName || username}!`, 'success');
                
            } else {
                showNotification('❌ Invalid username or password. Please try again.', 'error');
            }
        }

        function handleRegistration(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('reg-fullname').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const termsAccepted = document.getElementById('reg-terms').checked;
            
            // Validation
            if (!fullName || !email || !username || !password || !confirmPassword) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (!termsAccepted) {
                showNotification('Please accept the Terms of Service', 'error');
                return;
            }
            
            // Check if username already exists
            const users = getStoredUsers();
            if (users[username]) {
                showNotification('Username already exists. Please choose a different one.', 'error');
                return;
            }
            
            // Save new user
            saveUser(username, password, email, fullName);
            
            // Auto-login the new user
            currentUser = { username: username, fullName: fullName, email: email };
            
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('current-user').textContent = fullName;
            document.getElementById('mobile-user').textContent = fullName;
            
            initializeMobileApp();
            showNotification(`🎉 Welcome to PSW Suite, ${fullName}! Account created successfully.`, 'success');
        }

        function logout() {
            if (currentAssessment) {
                if (!confirm('You have an assessment in progress. Logout anyway?')) {
                    return;
                }
            }
            
            localStorage.removeItem('pswMobileSession');
            currentUser = null;
            currentAssessment = null;
            assessmentResponses = {};
            encryptionKey = null;
            
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('assessment-screen').classList.add('hidden');
            document.getElementById('report-screen').classList.add('hidden');
            
            document.getElementById('login-form').reset();
            showNotification('🚪 Logged out successfully', 'success');
        }

        // Mobile UI functions
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showCategory(category) {
            // Hide all categories
            document.querySelectorAll('.assessment-category').forEach(cat => {
                cat.classList.add('hidden');
            });
            
            // Show selected category
            document.getElementById(`category-${category}`).classList.remove('hidden');
            
            // Update tab styles
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                tab.classList.add('text-gray-600');
            });
            
            document.getElementById(`tab-${category}`).classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            document.getElementById(`tab-${category}`).classList.remove('text-gray-600');
        }

        function startAssessment(assessmentType) {
            if (!assessmentTemplates[assessmentType]) {
                showNotification('Assessment type not found', 'error');
                return;
            }
            
            currentAssessment = assessmentTemplates[assessmentType];
            currentQuestionIndex = 0;
            assessmentResponses = {};
            
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('assessment-screen').classList.remove('hidden');
            
            document.getElementById('assessment-title').textContent = currentAssessment.title;
            document.getElementById('assessment-description').textContent = currentAssessment.description;
            document.getElementById('total-questions').textContent = currentAssessment.questions.length;
            
            // Set today's date as default
            document.getElementById('session-date').value = new Date().toISOString().split('T')[0];
            
            loadQuestion();
            showNotification('📋 Assessment started - all data encrypted', 'success');
        }

        function loadQuestion() {
            if (!currentAssessment || currentQuestionIndex >= currentAssessment.questions.length) {
                return;
            }
            
            const question = currentAssessment.questions[currentQuestionIndex];
            const container = document.getElementById('question-container');
            
            let questionHTML = `
                <div class="mb-6">
                    <div class="mb-4">
                        <span class="text-sm font-medium text-purple-600 bg-purple-100 px-3 py-1 rounded-full">
                            ${question.category}
                        </span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">${question.question}</h3>
            `;
            
            if (question.type === 'radio') {
                questionHTML += '<div class="space-y-3">';
                question.options.forEach((option, index) => {
                    const isChecked = assessmentResponses[question.id] === option ? 'checked' : '';
                    questionHTML += `
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer touch-button">
                            <input type="radio" name="${question.id}" value="${option}" ${isChecked} 
                                   class="mr-3 text-blue-600" onchange="saveResponse('${question.id}', this.value)">
                            <span class="text-sm">${option}</span>
                        </label>
                    `;
                });
                questionHTML += '</div>';
            } else if (question.type === 'checkbox') {
                questionHTML += '<div class="space-y-3">';
                question.options.forEach((option, index) => {
                    const savedResponses = assessmentResponses[question.id] || [];
                    const isChecked = savedResponses.includes(option) ? 'checked' : '';
                    questionHTML += `
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer touch-button">
                            <input type="checkbox" value="${option}" ${isChecked} 
                                   class="mr-3 text-blue-600" onchange="saveCheckboxResponse('${question.id}', this.value, this.checked)">
                            <span class="text-sm">${option}</span>
                        </label>
                    `;
                });
                questionHTML += '</div>';
            } else if (question.type === 'textarea') {
                const savedValue = assessmentResponses[question.id] || '';
                questionHTML += `
                    <textarea name="${question.id}" rows="4" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                              placeholder="Enter your response here..."
                              onchange="saveResponse('${question.id}', this.value)">${savedValue}</textarea>
                `;
            } else if (question.type === 'select') {
                const savedValue = assessmentResponses[question.id] || '';
                questionHTML += `<select name="${question.id}" class="mobile-input focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="saveResponse('${question.id}', this.value)">`;
                questionHTML += '<option value="">Select an option...</option>';
                question.options.forEach(option => {
                    const isSelected = savedValue === option ? 'selected' : '';
                    questionHTML += `<option value="${option}" ${isSelected}>${option}</option>`;
                });
                questionHTML += '</select>';
            }
            
            questionHTML += '</div>';
            container.innerHTML = questionHTML;
            
            updateProgress();
            updateNavigation();
        }

        function saveResponse(questionId, value) {
            assessmentResponses[questionId] = value;
        }

        function saveCheckboxResponse(questionId, value, checked) {
            if (!assessmentResponses[questionId]) {
                assessmentResponses[questionId] = [];
            }
            
            if (checked) {
                if (!assessmentResponses[questionId].includes(value)) {
                    assessmentResponses[questionId].push(value);
                }
            } else {
                assessmentResponses[questionId] = assessmentResponses[questionId].filter(item => item !== value);
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentAssessment.questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-percentage').textContent = `${Math.round(progress)}%`;
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            
            const remainingQuestions = currentAssessment.questions.length - (currentQuestionIndex + 1);
            const estimatedMinutes = Math.ceil(remainingQuestions * 1.5);
            document.getElementById('estimated-time').textContent = `Est. ${estimatedMinutes} min remaining`;
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const completeBtn = document.getElementById('complete-btn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentAssessment.questions.length - 1) {
                nextBtn.classList.add('hidden');
                completeBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                completeBtn.classList.add('hidden');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentAssessment.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function skipQuestion() {
            if (currentQuestionIndex < currentAssessment.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                showNotification('Question skipped', 'info');
            }
        }

        function saveProgress() {
            mobileSaveData();
            showNotification('💾 Progress saved securely', 'success');
        }

        function completeAssessment() {
            const clientName = document.getElementById('client-name').value;
            const sessionDate = document.getElementById('session-date').value;
            
            if (!clientName || !sessionDate) {
                showNotification('Please fill in client name and session date', 'error');
                return;
            }
            
            const assessment = {
                id: Date.now(),
                type: currentAssessment.title,
                clientName: clientName,
                clientDOB: document.getElementById('client-dob').value,
                clientGender: document.getElementById('client-gender').value,
                sessionDate: sessionDate,
                completedDate: new Date().toISOString(),
                responses: assessmentResponses,
                practitioner: currentUser
            };
            
            completedAssessments.push(assessment);
            mobileSaveData();
            
            showReport(assessment);
            showNotification('✅ Assessment completed and encrypted!', 'success');
        }

        function exitAssessment() {
            if (Object.keys(assessmentResponses).length > 0) {
                if (!confirm('Exit assessment? Unsaved progress will be lost.')) {
                    return;
                }
            }
            
            document.getElementById('assessment-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            currentAssessment = null;
            currentQuestionIndex = 0;
            assessmentResponses = {};
        }

        function showReport(assessment) {
            document.getElementById('assessment-screen').classList.add('hidden');
            document.getElementById('report-screen').classList.remove('hidden');
            
            document.getElementById('report-date').textContent = new Date(assessment.completedDate).toLocaleDateString();
            
            let reportHTML = `
                <div class="bg-white rounded-xl p-4 card-shadow mb-4">
                    <h2 class="text-lg font-bold text-gray-900 mb-3">Client Information</h2>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div><strong>Name:</strong> ${assessment.clientName}</div>
                        <div><strong>Date:</strong> ${assessment.sessionDate}</div>
                        <div><strong>DOB:</strong> ${assessment.clientDOB || 'Not provided'}</div>
                        <div><strong>Gender:</strong> ${assessment.clientGender || 'Not provided'}</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 card-shadow mb-4">
                    <h2 class="text-lg font-bold text-gray-900 mb-3">Assessment: ${assessment.type}</h2>
                    <div class="space-y-4">
            `;
            
            // Group responses by category
            const responsesByCategory = {};
            currentAssessment.questions.forEach(question => {
                if (!responsesByCategory[question.category]) {
                    responsesByCategory[question.category] = [];
                }
                responsesByCategory[question.category].push({
                    question: question.question,
                    response: assessment.responses[question.id] || 'Not answered'
                });
            });
            
            Object.keys(responsesByCategory).forEach(category => {
                reportHTML += `
                    <div class="border-l-4 border-blue-500 pl-4 mb-4">
                        <h3 class="font-semibold text-blue-900 mb-2">${category}</h3>
                        <div class="space-y-2">
                `;
                
                responsesByCategory[category].forEach(item => {
                    reportHTML += `
                        <div class="text-sm">
                            <p class="font-medium text-gray-700">${item.question}</p>
                            <p class="text-gray-600 ml-2">${Array.isArray(item.response) ? item.response.join(', ') : item.response}</p>
                        </div>
                    `;
                });
                
                reportHTML += '</div></div>';
            });
            
            reportHTML += '</div></div>';
            
            // Add scoring if applicable
            if (assessment.type.includes('PHQ-9') || assessment.type.includes('Depression')) {
                const phq9Score = calculatePHQ9Score(assessment.responses);
                reportHTML += `
                    <div class="bg-blue-50 rounded-xl p-4 border border-blue-200 mb-4">
                        <h3 class="font-bold text-blue-900 mb-2">📊 PHQ-9 Score</h3>
                        <div class="text-2xl font-bold text-blue-600 mb-2">${phq9Score.total}/27</div>
                        <div class="text-sm text-blue-800">
                            <strong>Severity:</strong> ${phq9Score.severity}<br>
                            <strong>Recommendation:</strong> ${phq9Score.recommendation}
                        </div>
                    </div>
                `;
            }
            
            if (assessment.type.includes('GAD-7') || assessment.type.includes('Anxiety')) {
                const gad7Score = calculateGAD7Score(assessment.responses);
                reportHTML += `
                    <div class="bg-yellow-50 rounded-xl p-4 border border-yellow-200 mb-4">
                        <h3 class="font-bold text-yellow-900 mb-2">📊 GAD-7 Score</h3>
                        <div class="text-2xl font-bold text-yellow-600 mb-2">${gad7Score.total}/21</div>
                        <div class="text-sm text-yellow-800">
                            <strong>Severity:</strong> ${gad7Score.severity}<br>
                            <strong>Recommendation:</strong> ${gad7Score.recommendation}
                        </div>
                    </div>
                `;
            }
            
            if (assessment.type.includes('Career')) {
                const careerResults = calculateCareerAssessment(assessment.responses);
                reportHTML += `
                    <div class="bg-purple-50 rounded-xl p-4 border border-purple-200 mb-4">
                        <h3 class="font-bold text-purple-900 mb-3">💼 Holland Code Results</h3>
                        <div class="space-y-3">
                            ${careerResults.hollandCode.map(type => `
                                <div class="bg-white p-3 rounded-lg">
                                    <div class="flex justify-between items-center mb-2">
                                        <h4 class="font-semibold text-purple-800">${type.name} (${type.code})</h4>
                                        <span class="text-lg font-bold text-purple-600">${type.score}%</span>
                                    </div>
                                    <p class="text-sm text-purple-700">${type.description}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-4 bg-white p-3 rounded-lg">
                            <h4 class="font-semibold text-purple-800 mb-2">🎯 Top Career Matches:</h4>
                            <ul class="text-sm text-purple-700 space-y-1">
                                ${careerResults.careerMatches.map(career => `<li>• ${career}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="mt-4 bg-white p-3 rounded-lg">
                            <h4 class="font-semibold text-purple-800 mb-2">💪 Skill Strengths:</h4>
                            <div class="text-sm text-purple-700">
                                ${careerResults.skillStrengths.map(skill => `<span class="inline-block bg-purple-100 px-2 py-1 rounded mr-2 mb-1">${skill}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Add intervention recommendations
            reportHTML += generateInterventionRecommendations(assessment);
            
            document.getElementById('report-content').innerHTML = reportHTML;
        }

        function calculatePHQ9Score(responses) {
            const phq9Questions = ['phq9_1', 'phq9_2', 'phq9_3', 'phq9_4', 'phq9_5', 'phq9_6', 'phq9_7', 'phq9_8', 'phq9_9'];
            let total = 0;
            
            phq9Questions.forEach(questionId => {
                const response = responses[questionId];
                if (response === 'Not at all') total += 0;
                else if (response === 'Several days') total += 1;
                else if (response === 'More than half the days') total += 2;
                else if (response === 'Nearly every day') total += 3;
            });
            
            let severity, recommendation;
            if (total <= 4) {
                severity = 'Minimal depression';
                recommendation = 'Monitor symptoms';
            } else if (total <= 9) {
                severity = 'Mild depression';
                recommendation = 'Consider counseling or therapy';
            } else if (total <= 14) {
                severity = 'Moderate depression';
                recommendation = 'Therapy recommended, consider medication';
            } else if (total <= 19) {
                severity = 'Moderately severe depression';
                recommendation = 'Therapy and medication recommended';
            } else {
                severity = 'Severe depression';
                recommendation = 'Immediate treatment with therapy and medication';
            }
            
            return { total, severity, recommendation };
        }

        function calculateGAD7Score(responses) {
            const gad7Questions = ['gad7_1', 'gad7_2', 'gad7_3', 'gad7_4', 'gad7_5', 'gad7_6', 'gad7_7'];
            let total = 0;
            
            gad7Questions.forEach(questionId => {
                const response = responses[questionId];
                if (response === 'Not at all') total += 0;
                else if (response === 'Several days') total += 1;
                else if (response === 'More than half the days') total += 2;
                else if (response === 'Nearly every day') total += 3;
            });
            
            let severity, recommendation;
            if (total <= 4) {
                severity = 'Minimal anxiety';
                recommendation = 'Monitor symptoms';
            } else if (total <= 9) {
                severity = 'Mild anxiety';
                recommendation = 'Consider counseling or relaxation techniques';
            } else if (total <= 14) {
                severity = 'Moderate anxiety';
                recommendation = 'Therapy recommended, consider medication';
            } else {
                severity = 'Severe anxiety';
                recommendation = 'Immediate treatment with therapy and medication';
            }
            
            return { total, severity, recommendation };
        }

        function calculateCareerAssessment(responses) {
            // Calculate Holland Code scores
            const hollandTypes = {
                'Realistic': {
                    code: 'R',
                    description: 'Practical, hands-on, problem-solvers who enjoy working with tools, machines, and physical materials',
                    activities: responses.realistic_activities || [],
                    careers: ['Engineer', 'Mechanic', 'Carpenter', 'Farmer', 'Pilot', 'Electrician', 'Chef', 'Veterinarian']
                },
                'Investigative': {
                    code: 'I', 
                    description: 'Analytical, intellectual, scientific thinkers who enjoy research and solving complex problems',
                    activities: responses.investigative_activities || [],
                    careers: ['Scientist', 'Researcher', 'Doctor', 'Psychologist', 'Analyst', 'Professor', 'Pharmacist', 'Economist']
                },
                'Artistic': {
                    code: 'A',
                    description: 'Creative, expressive, original thinkers who value aesthetics and self-expression',
                    activities: responses.artistic_activities || [],
                    careers: ['Artist', 'Writer', 'Designer', 'Musician', 'Actor', 'Photographer', 'Architect', 'Journalist']
                },
                'Social': {
                    code: 'S',
                    description: 'Helpful, caring, empathetic people who enjoy working with and helping others',
                    activities: responses.social_activities || [],
                    careers: ['Teacher', 'Counselor', 'Social Worker', 'Nurse', 'Therapist', 'Coach', 'Minister', 'Trainer']
                },
                'Enterprising': {
                    code: 'E',
                    description: 'Ambitious, energetic, persuasive leaders who enjoy influencing and managing others',
                    activities: responses.enterprising_activities || [],
                    careers: ['Manager', 'Sales Rep', 'Entrepreneur', 'Lawyer', 'Executive', 'Politician', 'Realtor', 'Consultant']
                },
                'Conventional': {
                    code: 'C',
                    description: 'Organized, detail-oriented, efficient workers who prefer structured environments',
                    activities: responses.conventional_activities || [],
                    careers: ['Accountant', 'Administrator', 'Banker', 'Secretary', 'Clerk', 'Bookkeeper', 'Auditor', 'Analyst']
                }
            };

            // Calculate scores for each Holland type
            const hollandScores = Object.keys(hollandTypes).map(typeName => {
                const type = hollandTypes[typeName];
                const score = Math.round((type.activities.length / 8) * 100); // 8 options per category
                return {
                    name: typeName,
                    code: type.code,
                    score: score,
                    description: type.description,
                    careers: type.careers
                };
            }).sort((a, b) => b.score - a.score);

            // Get top 3 Holland types
            const topThreeTypes = hollandScores.slice(0, 3);
            
            // Generate career matches based on top types
            let careerMatches = [];
            topThreeTypes.forEach(type => {
                careerMatches = careerMatches.concat(type.careers.slice(0, 3));
            });
            
            // Remove duplicates and limit to top 8
            careerMatches = [...new Set(careerMatches)].slice(0, 8);

            // Analyze skill strengths
            const skillStrengths = [];
            const skillResponses = {
                'Communication': responses.skills_assessment,
                'Leadership': responses.leadership_skills,
                'Technical': responses.technical_skills,
                'Analytical': responses.analytical_skills,
                'Creative': responses.creative_skills
            };

            Object.keys(skillResponses).forEach(skill => {
                const rating = skillResponses[skill];
                if (rating === 'Excellent' || rating === 'Good') {
                    skillStrengths.push(skill);
                }
            });

            return {
                hollandCode: hollandScores,
                careerMatches: careerMatches,
                skillStrengths: skillStrengths,
                workValues: responses.work_values || [],
                preferredEnvironment: responses.work_environment,
                careerStage: responses.career_stage,
                educationLevel: responses.education_level
            };
        }

        function generateInterventionRecommendations(assessment) {
            let interventionHTML = `
                <div class="bg-purple-50 rounded-xl p-4 border border-purple-200 mb-4">
                    <h3 class="font-bold text-purple-900 mb-3">🎯 Intervention Recommendations</h3>
                    <div class="space-y-3 text-sm">
            `;
            
            // Add specific recommendations based on assessment type
            if (assessment.type.includes('Depression')) {
                interventionHTML += `
                    <div class="bg-white p-3 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">Depression Interventions:</h4>
                        <ul class="text-purple-700 space-y-1">
                            <li>• Cognitive Behavioral Therapy (CBT)</li>
                            <li>• Behavioral activation techniques</li>
                            <li>• Mindfulness-based interventions</li>
                            <li>• Social support enhancement</li>
                            <li>• Exercise and lifestyle modifications</li>
                        </ul>
                    </div>
                `;
            }
            
            if (assessment.type.includes('Anxiety')) {
                interventionHTML += `
                    <div class="bg-white p-3 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">Anxiety Interventions:</h4>
                        <ul class="text-purple-700 space-y-1">
                            <li>• Exposure therapy techniques</li>
                            <li>• Relaxation and breathing exercises</li>
                            <li>• Cognitive restructuring</li>
                            <li>• Stress management skills</li>
                            <li>• Progressive muscle relaxation</li>
                        </ul>
                    </div>
                `;
            }
            
            if (assessment.type.includes('Risk')) {
                interventionHTML += `
                    <div class="bg-red-50 p-3 rounded-lg border border-red-200">
                        <h4 class="font-semibold text-red-800 mb-2">🚨 Safety Interventions:</h4>
                        <ul class="text-red-700 space-y-1">
                            <li>• Develop comprehensive safety plan</li>
                            <li>• Remove means of self-harm</li>
                            <li>• Increase support system involvement</li>
                            <li>• Consider hospitalization if high risk</li>
                            <li>• Crisis hotline numbers provided</li>
                        </ul>
                    </div>
                `;
            }
            
            if (assessment.type.includes('Career')) {
                interventionHTML += `
                    <div class="bg-white p-3 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">💼 Career Development Interventions:</h4>
                        <ul class="text-purple-700 space-y-1">
                            <li>• Career exploration and research activities</li>
                            <li>• Skills development and training programs</li>
                            <li>• Networking and informational interviews</li>
                            <li>• Resume and interview preparation</li>
                            <li>• Job search strategies and techniques</li>
                            <li>• Professional development planning</li>
                            <li>• Work-life balance counseling</li>
                            <li>• Career transition support</li>
                        </ul>
                    </div>
                `;
            }
            
            interventionHTML += `
                    </div>
                </div>
            `;
            
            return interventionHTML;
        }

        function backToDashboard() {
            document.getElementById('report-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            updateDashboard();
        }

        function downloadReport() {
            showNotification('📥 Report download prepared (Demo - would download PDF)', 'info');
        }

        function emailReport() {
            showNotification('📧 Secure email prepared (Demo - would send encrypted email)', 'info');
        }

        function printReport() {
            window.print();
        }

        function exportAllData() {
            if (completedAssessments.length === 0) {
                showNotification('No assessments to export', 'info');
                return;
            }
            
            const exportData = {
                exportDate: new Date().toISOString(),
                practitioner: currentUser,
                assessments: completedAssessments,
                totalCount: completedAssessments.length
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            // Create download link
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `PSW_Assessments_Export_${new Date().toISOString().split('T')[0]}.json`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('📊 Assessment data exported successfully', 'success');
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to clear all assessment data? This cannot be undone.')) {
                return;
            }
            
            completedAssessments = [];
            localStorage.removeItem('pswMobileAssessments');
            updateDashboard();
            showNotification('🗑️ All data cleared securely', 'success');
        }

        function showSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function saveSettings() {
            const settings = {
                practitionerName: document.getElementById('practitioner-name').value,
                licenseNumber: document.getElementById('license-number').value,
                practitionerEmail: document.getElementById('practitioner-email').value,
                autoLogout: document.getElementById('auto-logout').checked,
                secureDelete: document.getElementById('secure-delete').checked
            };
            
            localStorage.setItem('pswMobileSettings', JSON.stringify(settings));
            closeSettings();
            showNotification('⚙️ Settings saved successfully', 'success');
        }

        function showAssessmentGuide() {
            showNotification('📖 Assessment guide would open here (Demo)', 'info');
        }

        function generateInterventionPlan() {
            if (completedAssessments.length === 0) {
                showNotification('Complete an assessment first to generate intervention plans', 'info');
                return;
            }
            showNotification('🎯 Intervention plan generator would open here (Demo)', 'info');
        }

        function createSocialDiagnosis() {
            if (completedAssessments.length === 0) {
                showNotification('Complete an assessment first to create social diagnoses', 'info');
                return;
            }
            showNotification('🏥 Social diagnosis tool would open here (Demo)', 'info');
        }

        function showCrisisResources() {
            const crisisHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-red-900">🚨 Crisis Resources</h2>
                            <button onclick="closeCrisisResources()" class="text-gray-400 hover:text-gray-600 text-2xl">×</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                                <h3 class="font-bold text-red-900 mb-2">🆘 Emergency Contacts</h3>
                                <div class="space-y-2 text-sm">
                                    <div><strong>National Suicide Prevention Lifeline:</strong><br>
                                    <a href="tel:988" class="text-red-600 font-bold text-lg">988</a></div>
                                    <div><strong>Crisis Text Line:</strong><br>
                                    Text HOME to <a href="sms:741741" class="text-red-600 font-bold">741741</a></div>
                                    <div><strong>Emergency Services:</strong><br>
                                    <a href="tel:911" class="text-red-600 font-bold text-lg">911</a></div>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                                <h3 class="font-bold text-blue-900 mb-2">🏥 Local Resources</h3>
                                <div class="text-sm text-blue-800">
                                    <p>• Local emergency room</p>
                                    <p>• Community mental health center</p>
                                    <p>• Mobile crisis team</p>
                                    <p>• Psychiatric urgent care</p>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                                <h3 class="font-bold text-green-900 mb-2">💚 Support Resources</h3>
                                <div class="text-sm text-green-800">
                                    <p>• NAMI Support Groups</p>
                                    <p>• Peer support services</p>
                                    <p>• Online therapy platforms</p>
                                    <p>• Community support groups</p>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="closeCrisisResources()" class="w-full mt-4 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 touch-button">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', crisisHTML);
        }

        function closeCrisisResources() {
            const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (modal) {
                modal.remove();
            }
        }

        function updateDashboard() {
            const today = new Date().toDateString();
            const todayCount = completedAssessments.filter(a => 
                new Date(a.completedDate).toDateString() === today
            ).length;
            
            document.getElementById('today-count').textContent = todayCount;
            document.getElementById('total-count').textContent = completedAssessments.length;
            document.getElementById('intervention-count').textContent = completedAssessments.length;
            
            // Update recent assessments
            const recentContainer = document.getElementById('recent-assessments');
            if (completedAssessments.length === 0) {
                recentContainer.innerHTML = '<p class="text-gray-600 text-center py-8 text-sm">No assessments completed yet. Start your first assessment above!</p>';
            } else {
                let recentHTML = '';
                completedAssessments.slice(-5).reverse().forEach(assessment => {
                    recentHTML += `
                        <div class="border-l-4 border-blue-500 pl-4 py-3 border-b border-gray-100 last:border-b-0">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-semibold text-gray-900 text-sm">${assessment.type}</h4>
                                    <p class="text-xs text-gray-600">Client: ${assessment.clientName}</p>
                                    <p class="text-xs text-gray-500">${new Date(assessment.completedDate).toLocaleDateString()}</p>
                                </div>
                                <button onclick="showReport(${JSON.stringify(assessment).replace(/"/g, '&quot;')})" 
                                        class="text-blue-600 hover:text-blue-800 text-xs touch-button px-2 py-1 rounded">
                                    View
                                </button>
                            </div>
                        </div>
                    `;
                });
                recentContainer.innerHTML = recentHTML;
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'bg-green-100 border-green-500 text-green-700',
                error: 'bg-red-100 border-red-500 text-red-700',
                info: 'bg-blue-100 border-blue-500 text-blue-700',
                warning: 'bg-yellow-100 border-yellow-500 text-yellow-700'
            };
            
            notification.className = `${colors[type]} border-l-4 p-3 rounded-lg shadow-lg mb-2 text-sm fade-in`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function checkExistingSession() {
            try {
                const sessionData = localStorage.getItem('pswMobileSession');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    if (session.expires > Date.now()) {
                        currentUser = session.username;
                        document.getElementById('login-screen').classList.add('hidden');
                        document.getElementById('main-app').classList.remove('hidden');
                        document.getElementById('current-user').textContent = session.username;
                        document.getElementById('mobile-user').textContent = session.username;
                        initializeMobileApp();
                        showNotification('🔐 Mobile session restored!', 'success');
                        return true;
                    } else {
                        localStorage.removeItem('pswMobileSession');
                    }
                }
            } catch (error) {
                localStorage.removeItem('pswMobileSession');
            }
            return false;
        }

        function initializeMobileApp() {
            mobileLoadData();
            updateDashboard();
            
            // Update mobile detection
            isMobile = window.innerWidth <= 768;
            
            // Load settings
            try {
                const settings = localStorage.getItem('pswMobileSettings');
                if (settings) {
                    const settingsData = JSON.parse(settings);
                    document.getElementById('practitioner-name').value = settingsData.practitionerName || 'Dr. [Your Name]';
                    document.getElementById('license-number').value = settingsData.licenseNumber || 'LCSW-12345';
                    document.getElementById('practitioner-email').value = settingsData.practitionerEmail || 'your.email@example.com';
                    document.getElementById('auto-logout').checked = settingsData.autoLogout !== false;
                    document.getElementById('secure-delete').checked = settingsData.secureDelete !== false;
                }
            } catch (error) {
                console.warn('Could not load settings');
            }
        }

        // Mobile-specific event listeners
        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
        });

        // Touch event handling for better mobile experience
        document.addEventListener('touchstart', function(e) {
            // Prevent double-tap zoom on buttons
            if (e.target.classList.contains('touch-button')) {
                e.preventDefault();
            }
        }, { passive: false });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set up login and registration forms
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('registration-form').addEventListener('submit', handleRegistration);
            
            // Check for existing session
            if (!checkExistingSession()) {
                // Show login screen
                document.getElementById('login-screen').classList.remove('hidden');
            }
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                const menu = document.getElementById('mobile-menu');
                const menuButton = e.target.closest('button[onclick="toggleMobileMenu()"]');
                
                if (!menu.contains(e.target) && !menuButton && !menu.classList.contains('hidden')) {
                    menu.classList.add('hidden');
                }
            });
            
            // Prevent zoom on input focus (iOS)
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    if (window.innerWidth <= 768) {
                        document.querySelector('meta[name=viewport]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0');
                    }
                });
                
                input.addEventListener('blur', function() {
                    if (window.innerWidth <= 768) {
                        document.querySelector('meta[name=viewport]').setAttribute('content', 'width=device-width, initial-scale=1.0');
                    }
                });
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a08c71b3353bd4',t:'MTc1NDMzNjY1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
